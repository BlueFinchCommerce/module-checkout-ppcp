import{m as e,a as t,g as s,P as a,c as r,h as i,d as o,f as d,n,b as c,j as l,o as h}from"../../../../createPPCPPaymentRest-BV8Hjeu6.min.js";import{l as u}from"../../../../addScript-Ca9R_zUQ.min.js";var p={name:"PpcpCreditCardPayment",data:()=>({isMethodSelected:!1,errorMessage:"",hostedNumberErrorMessage:"",hostedDateErrorMessage:"",hostedCvvErrorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,MyButton:null,checkboxComponent:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_card",method:"ppcp_card",numberField:"#card-number-field-container",cvvField:"#card-cvv-field-container",expiryField:"#card-expiry-field-container",isRecaptchaVisible:()=>{},orderID:null,storeMethod:!1,isLoggedIn:!1}),props:{open:{type:Boolean,required:!1}},computed:{...e(a,["card","environment","buyerCountry","productionClientId","sandboxClientId"])},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:s,Recaptcha:a,Agreements:r,MyButton:i,Checkbox:o}}}=await import(window.geneCheckout.main);this.Agreements=r,this.ErrorMessage=e,this.RadioButton=s,this.Recaptcha=a,this.PrivacyPolicy=t,this.MyButton=i,this.checkboxComponent=o},async created(){const[e,t,s,a,r]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore","stores.useCustomerStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,this.isLoggedIn=r.isLoggedIn,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await s.getInitialConfig(),await a.getCart(),await this.addScripts(),await this.initCardFields(),this.open&&await this.selectPaymentMethod()},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_card"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},methods:{...t(a,["makePayment"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.geneCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_card")},async addScripts(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=u(),s={intent:this.card.paymentAction,currency:e.currencyCode,components:"card-fields"};return"sandbox"===this.environment?(s["buyer-country"]=this.buyerCountry,s["client-id"]=this.sandboxClientId):s["client-id"]=this.productionClientId,t("https://www.paypal.com/sdk/js",s,"ppcp_card")},async initCardFields(){if(window[`paypal_${this.method}`]){const e=window[`paypal_${this.method}`].CardFields({createOrder:async()=>{const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useLoadingStore"]);e.setLoadingState(!0);try{const e=await s(this.method,this.card.vaultActive,1),t=JSON.parse(e),[a]=t;return this.orderID=a,this.orderID}catch(t){return e.setLoadingState(!1),console.error("Error during createOrder:",t),null}},onApprove:async()=>{const[e,t,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useLoadingStore","stores.usePaymentStore","stores.useCartStore"]);return this.makePayment(s.cart.email,this.orderID,this.method,!1,this.storeMethod).then((()=>{window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()})).catch((s=>{e.setLoadingState(!1),t.setErrorMessage(s.message)}))},onError:async e=>{const[t,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);t.setErrorMessage(e),s.setLoadingState(!1)},style:this.getStyles()});await this.renderFields(e)}},async renderFields(e){const[t,s,a,r]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useAgreementStore","stores.useLoadingStore","stores.useRecaptchaStore"]);if(t.setErrorMessage(""),e.isEligible()){const i=document.querySelector(this.numberField),o=document.querySelector(this.cvvField),d=document.querySelector(this.expiryField),n=e.NumberField({placeholder:"4111 1111 1111 1111",inputEvents:{onBlur:e=>{i.className=e.fields.cardNumberField.isValid||e.fields.cardNumberField.isEmpty?"valid":"invalid"},onFocus:()=>{}}}),c=e.CVVField({placeholder:"123",inputEvents:{onBlur:e=>{o.className=e.fields.cardCvvField.isValid||e.fields.cardCvvField.isEmpty?"valid":"invalid"},onFocus:()=>{}}}),l=e.ExpiryField({placeholder:"MM/YY",inputEvents:{onBlur:e=>{d.className=e.fields.cardExpiryField.isValid||e.fields.cardExpiryField.isEmpty?"valid":"invalid"},onFocus:()=>{}}});i&&!i.innerHTML.trim()&&n.render(i),o&&!o.innerHTML.trim()&&c.render(o),d&&!d.innerHTML.trim()&&l.render(d),document.getElementById("card-field-submit-button").addEventListener("click",(async()=>{const i=s.validateAgreements(),o=await r.validateToken("placeOrder");return i&&o?(a.setLoadingState(!0),e.getState().then((s=>{s.isFormValid?e.submit().then((()=>{})).catch((e=>{t.setErrorMessage(e)})):(s.errors.includes("INVALID_NUMBER")&&(a.setLoadingState(!1),this.hostedNumberErrorMessage="Card number is not valid."),s.errors.includes("INVALID_EXPIRY")&&(a.setLoadingState(!1),this.hostedDateErrorMessage="Expiry date is not valid."),s.errors.includes("INVALID_CVV")&&(a.setLoadingState(!1),this.hostedCvvErrorMessage="CVV is not valid."))})),!0):(a.setLoadingState(!1),!1)}))}},getStyles:()=>({".valid":{color:"green"},".invalid":{color:"red"},input:{padding:"8px 15px","font-size":"16px"}})}};const m={class:"field required"},y=i("label",{for:"card-number-field-container",class:"label"},[i("span",null," Credit Card Number ")],-1),g=i("div",{id:"card-number-field-container"},null,-1),v={class:"field required"},M=i("label",{for:"card-expiry-field-container",class:"label"},[i("span",null," Expiration Date ")],-1),C=i("div",{id:"card-expiry-field-container"},null,-1),b={class:"field required"},f=i("label",{for:"card-cvv-field-container",class:"label"},[i("span",null," Card Verification Number ")],-1),w=i("div",{id:"card-cvv-field-container"},null,-1),S={key:1,class:"card-content"},E={class:"recaptcha"};p.render=function(e,t,s,a,u,p){return h(),r("div",{class:n([{active:u.isMethodSelected},"card-container"])},[i("div",{class:n(["card-title",u.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e))},[(h(),o(d(u.RadioButton),{id:"card-select",text:e.card.title,checked:u.isMethodSelected,"data-cy":"card-radio",class:"card-radio",onClick:p.selectPaymentMethod,onKeydown:p.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"]))],34),u.errorMessage?(h(),o(d(u.ErrorMessage),{key:0,message:u.errorMessage,attached:!1},null,8,["message"])):c("v-if",!0),i("fieldset",{class:"card-fieldset",style:l({display:u.isMethodSelected?"block":"none"})},[i("div",m,[y,g,u.hostedNumberErrorMessage?(h(),o(d(u.ErrorMessage),{key:0,message:u.hostedNumberErrorMessage,attached:!1},null,8,["message"])):c("v-if",!0)]),i("div",v,[M,C,u.hostedDateErrorMessage?(h(),o(d(u.ErrorMessage),{key:0,message:u.hostedDateErrorMessage,attached:!1},null,8,["message"])):c("v-if",!0)]),i("div",b,[f,w,u.hostedCvvErrorMessage?(h(),o(d(u.ErrorMessage),{key:0,message:u.hostedCvvErrorMessage,attached:!1},null,8,["message"])):c("v-if",!0)])],4),(h(),o(d(u.MyButton),{label:e.$t("Pay"),style:l({display:u.isMethodSelected?"block":"none"}),primary:"",id:"card-field-submit-button"},null,8,["label","style"])),u.isMethodSelected?(h(),r("div",S,[(h(),o(d(u.PrivacyPolicy))),i("div",E,[u.isRecaptchaVisible("placeOrder")?(h(),o(d(u.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPaymentCredit"})):c("v-if",!0)]),u.isLoggedIn&&"ppcp_card"===u.selectedMethod&&e.card.vaultActive?(h(),o(d(u.checkboxComponent),{key:0,id:"ppcp-store-method",class:"ppcp-store-method",checked:u.storeMethod,"change-handler":({currentTarget:e})=>u.storeMethod=e.checked,text:"Save for later use.","data-cy":"ppcp-save-payment-card-checkbox"},null,8,["checked","change-handler"])):c("v-if",!0),(h(),o(d(u.Agreements),{id:"ppcp-checkout-card"}))])):c("v-if",!0)],2)},p.__file="src/components/PaymentPage/PaymentMethods/CreditCard/CreditCard.vue";export{p as default};

import{m as e,a as t,P as a,g as o,c as s,h as i,d as n,f as p,n as l,b as r,w as c,o as d}from"../../../../PpcpStore-Dc8hu8rx.min.js";import{c as h,l as y}from"../../../../createPPCPPaymentRest-DUkFikGQ.min.js";
/**
* @vue/runtime-dom v3.4.23
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const m=Symbol("_vod"),u=Symbol("_vsh"),A={beforeMount(e,{value:t},{transition:a}){e[m]="none"===e.style.display?"":e.style.display,a&&t?a.beforeEnter(e):P(e,t)},mounted(e,{value:t},{transition:a}){a&&t&&a.enter(e)},updated(e,{value:t,oldValue:a},{transition:o}){!t!=!a&&(o?t?(o.beforeEnter(e),P(e,!0),o.enter(e)):o.leave(e,(()=>{P(e,!1)})):P(e,t))},beforeUnmount(e,{value:t}){P(e,t)}};function P(e,t){e.style.display=t?e[m]:"none",e[u]=!t}var g={name:"PpcpApplePayPayment",data:()=>({isMethodSelected:!1,applePayLoaded:!1,applePayAvailable:!1,applePayConfig:null,isEligible:!1,errorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_applepay",method:"ppcp_applepay",isRecaptchaVisible:()=>{},orderID:null}),props:{open:{type:Boolean,required:!1}},computed:{...e(a,["apple","environment","buyerCountry","productionClientId","sandboxClientId"]),applePayLogo:()=>"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAsCAIAAABT1onSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABB5JREFUeNrsWVkodVEUds1zhogHQ5QpkSljhlzxwBOF8mAmKckQHhAPpEzFi4wPZhHyZshQCtf04NEQkSmZXfNXp/Z/uq7rXv+5fv9tr1J7r7P2cr691/ftdeCtrKwoKYqp4sfDw0MBkAgEAmUlBTIKhoKhYCgYCoaCoWB+Aszg4GB2dvbj4+Mv6s2+Z6WlpZWVlYaGhk1NTR+fon/t7+8/Pj5+fn5WU1Nzd3fPycn5pSczMzMDJBhMTEyIDUhJSRkYGLC1tXVwcNDT02ttbQXsjY0N+aLBFr7Jbg0NDQEBAYuLi58FuLi4NDc3sz1xcXH4dff392/yMQCR9mReX1+rq6u9vb2DgoJQVxjk5+ePj4+jfvh8fldXl0i8hobG2dkZ29Pb2wtnS0vLP+bM7e2tn5/f5uYmM52bm9PS0sIek4CpqanV1dXGxkbJedzc3JhKOzo66uzsXFtbA6MiIiLS09PhXFhYwDQ4OFhkFfx4gfDwcG44k5eXR5AwxkYCMzMzi4+P/zLP4eGhq6srBsnJySCbnZ2djY1NcXFxWFgYnCcnJyEhIXd3dyKrAgMDAZszzqirq0tOMjY2JrIEX6+1tbVsT3d3NyIvLi4wPjg4IH6hUAg/ChVjiAREkr2qo6PDwMBASs5IBUYyEijvzc2NyBIfHx8UD2hzdXW1vr5eUFDA0EZs/qysLJAQAyAxNjZmPwInMzIypASj+ve0gzbgjXV0dNhOExMTXKnb29vX19dPT09GRkZLS0teXl7sGIghPtxxViChtbU1PIWFhRUVFZiitDDFASLDyMgIlwKgra39sZSJvby81NTU1NfXs504E+w3DgeHZmVlJQJ1fn4e+w0VwSPQBvyG0MGPMKhleXn59PQ0pihUJycnS0tLLu+Z0NDQL/PgDc7Pz9mcqaqqEpttdnYW8WVlZeiDGE9JSYmvry8zxnWMpw8PDxhDIfr6+ji+ZxITE6UBg4L5o5LKyp/1bDiu6OhoxINsRBtVVFSYMaQZjIce7O7u8ni82NhYjtuZhISEL886NTUVzYs02fb39/39/dmeyclJEI9MMzMzh4aG6urqIiMj5dLOLC8vS0gCujOFQcze3r6oqEhsKhyLpqYmiQfjkSEmJoYEXF5empqa6urq4uaRSzvj6enZ09PDjB0dHXNzc9PS0nAtYGphYQH9YRhMzNzcHNUiNhUuHMga5CsqKgqKDKloa2sjZQbT19fHXkAYsEdybDS3trZAUDLFe6CRgfh+jIRYS+4ph4eHoYEk2+npKfups7MzBE3WRvObXbNcDc0OETeZwHBwaXJr+Lhob2/f29v70S9Nzg3KnpSUNDo6itqT4aL8nWAgYugJdnZ2mNbm/wYDDOhE6Z+aKBgKhoKhYCgYCuaH/gsgEAgUA8y7AAMADA24hckBBEQAAAAASUVORK5CYII="},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:a,Recaptcha:o,Agreements:s}}}=await import(window.geneCheckout.main);this.Agreements=s,this.ErrorMessage=e,this.RadioButton=a,this.Recaptcha=o,this.PrivacyPolicy=t},async created(){const[e,t,a,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await a.getInitialConfig(),await o.getCart(),window[`paypal_${this.method}`]||await this.addSdkScript(),this.showApplePay(),this.open&&await this.selectPaymentMethod()},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_applepay"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},methods:{...t(a,["makePayment","mapSelectedAddress","mapAppleAddress"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.geneCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_applepay")},async addSdkScript(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=y(),a={intent:this.apple.paymentAction,currency:e.currencyCode,components:"applepay"};"sandbox"===this.environment?(a["buyer-country"]=this.buyerCountry,a["client-id"]=this.sandboxClientId):a["client-id"]=this.productionClientId;try{await Promise.all([t("https://www.paypal.com/sdk/js",a,"ppcp_applepay"),t("https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js",{},"")])}catch(e){throw console.error("Error loading SDK scripts:",e),new Error("Failed to load required SDK scripts.")}},showApplePay(){if(!window.ApplePaySession||!window.ApplePaySession.canMakePayments||"https:"!==window.location.protocol)return;this.applePayAvailable=!0;window[`paypal_${this.method}`].Applepay().config().then((e=>{this.applePayConfig=e,this.isEligible=!!e.isEligible,this.applePayLoaded=!0})).catch((()=>{console.error("Error while fetching Apple Pay configuration.")}))},async onClick(){const[e,t,a,o,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.usePaymentStore"]);s.setErrorMessage("");if(!e.validateAgreements())return;const i=window[`paypal_${this.method}`].Applepay();try{const e={countryCode:a.countryCode,currencyCode:a.currencyCode,merchantCapabilities:this.applePayConfig.merchantCapabilities,supportedNetworks:this.applePayConfig.supportedNetworks,requiredBillingContactFields:["name","phone","email","postalAddress"],requiredShippingContactFields:[],total:{label:this.apple.merchantName,amount:(t.cartGrandTotal/100).toString(),type:"final"}},s=new window.ApplePaySession(4,e);s.onvalidatemerchant=e=>{i.validateMerchant({validationUrl:e.validationURL}).then((e=>{s.completeMerchantValidation(e.merchantSession)})).catch((e=>{console.error(e),s.abort(),o.setLoadingState(!1)}))},s.onpaymentauthorized=e=>this.onAuthorized(e,s),s.begin()}catch(e){await this.setApplePayError()}},async onAuthorized(e,t){const[a,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),s=window[`paypal_${this.method}`].Applepay(),{billingContact:i}=e.payment,n=await this.mapAppleAddress(i,a.cart.email,a.cart.shipping_addresses[0].telephone);let p=null;if(a.cart.is_virtual||(p=await this.mapSelectedAddress(a.cart.shipping_addresses[0])),!o.countries.some((({id:e})=>e===n.country_code)))return void t.completePayment(window.ApplePaySession.STATUS_FAILURE);const l=await h(this.method);[this.orderID]=JSON.parse(l),s.confirmOrder({orderId:this.orderID,token:e.payment.token,billingContact:e.payment.billingContact}).then((async()=>{try{window.geneCheckout.services.setAddressesOnCart(p,n,a.cart.email).then((()=>this.makePayment(a.cart.email,this.orderID,this.method,!1))).then((async()=>{t.completePayment(window.ApplePaySession.STATUS_SUCCESS),window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}))}catch(e){console.log(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE)}})).catch((e=>{e&&(console.error("Error confirming order with applepay token"),console.error(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE))}))}}};const w=["src"],S={key:2,class:"apple-pay-content"};g.render=function(e,t,a,h,y,m){const u=o("apple-pay-button");return y.applePayAvailable?(d(),s("div",{key:0,class:l([{active:y.isMethodSelected},"apple-pay-container"])},[i("div",{class:l(["apple-pay-title",y.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>m.selectPaymentMethod&&m.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>m.selectPaymentMethod&&m.selectPaymentMethod(...e))},[(d(),n(p(y.RadioButton),{id:"apple-pay-select",text:e.apple.title,checked:y.isMethodSelected,"data-cy":"apple-pay-radio",class:"apple-pay-radio",onClick:m.selectPaymentMethod,onKeydown:m.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"])),i("img",{width:"48px",class:"apple-pay-logo",src:m.applePayLogo,alt:"apple-pay-logo"},null,8,w)],34),y.applePayAvailable&&y.isMethodSelected?(d(),s("div",{key:0,class:l(["ppcp-apple-pay-button",y.applePayLoaded?"ppcp-apple-pay":"text-loading"])},[y.applePayLoaded?(d(),n(u,{key:0,onClick:m.onClick,id:"ppcp-apple-pay",type:"plain",locale:"en"},null,8,["onClick"])):r("v-if",!0)],2)):r("v-if",!0),y.errorMessage?(d(),n(p(y.ErrorMessage),{key:1,message:y.errorMessage,attached:!1},null,8,["message"])):r("v-if",!0),c(i("div",{id:"ppcp-apple-pay",class:l(!y.applePayLoaded&&y.isMethodSelected?"text-loading":""),"data-cy":"checkout-PPCPApplePay"},null,2),[[A,y.isMethodSelected]]),y.isMethodSelected?(d(),s("div",S,[(d(),n(p(y.PrivacyPolicy))),y.isRecaptchaVisible("placeOrder")?(d(),n(p(y.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPayment"})):r("v-if",!0),(d(),n(p(y.Agreements),{id:"ppcp-checkout-apple-pay"}))])):r("v-if",!0)],2)):r("v-if",!0)},g.__file="src/components/PaymentPage/PaymentMethods/ApplePay/ApplePay.vue";export{g as default};

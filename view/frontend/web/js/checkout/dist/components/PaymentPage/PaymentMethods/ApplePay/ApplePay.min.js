import{p as e}from"../../../../index-DvlQ7xrf.min.js";import{m as t,a,P as o,c as n,d as s,e as i,g as p,n as l,h as r,b as c,o as d}from"../../../../PpcpStore-cIPv95xA.min.js";import{c as h}from"../../../../createPPCPPaymentRest-ClXvBo5i.min.js";var y={name:"PpcpApplePayPayment",data:()=>({isMethodSelected:!1,applePayLoaded:!1,applePayAvailable:!1,applePayConfig:null,isEligible:!1,errorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_applepay",method:"ppcp_applepay",isRecaptchaVisible:()=>{},orderID:null}),props:{open:{type:Boolean,required:!1}},computed:{...t(o,["apple","environment","buyerCountry","productionClientId","sandboxClientId"]),applePayLogo:()=>"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAsCAIAAABT1onSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABB5JREFUeNrsWVkodVEUds1zhogHQ5QpkSljhlzxwBOF8mAmKckQHhAPpEzFi4wPZhHyZshQCtf04NEQkSmZXfNXp/Z/uq7rXv+5fv9tr1J7r7P2cr691/ftdeCtrKwoKYqp4sfDw0MBkAgEAmUlBTIKhoKhYCgYCoaCoWB+Aszg4GB2dvbj4+Mv6s2+Z6WlpZWVlYaGhk1NTR+fon/t7+8/Pj5+fn5WU1Nzd3fPycn5pSczMzMDJBhMTEyIDUhJSRkYGLC1tXVwcNDT02ttbQXsjY0N+aLBFr7Jbg0NDQEBAYuLi58FuLi4NDc3sz1xcXH4dff392/yMQCR9mReX1+rq6u9vb2DgoJQVxjk5+ePj4+jfvh8fldXl0i8hobG2dkZ29Pb2wtnS0vLP+bM7e2tn5/f5uYmM52bm9PS0sIek4CpqanV1dXGxkbJedzc3JhKOzo66uzsXFtbA6MiIiLS09PhXFhYwDQ4OFhkFfx4gfDwcG44k5eXR5AwxkYCMzMzi4+P/zLP4eGhq6srBsnJySCbnZ2djY1NcXFxWFgYnCcnJyEhIXd3dyKrAgMDAZszzqirq0tOMjY2JrIEX6+1tbVsT3d3NyIvLi4wPjg4IH6hUAg/ChVjiAREkr2qo6PDwMBASs5IBUYyEijvzc2NyBIfHx8UD2hzdXW1vr5eUFDA0EZs/qysLJAQAyAxNjZmPwInMzIypASj+ve0gzbgjXV0dNhOExMTXKnb29vX19dPT09GRkZLS0teXl7sGIghPtxxViChtbU1PIWFhRUVFZiitDDFASLDyMgIlwKgra39sZSJvby81NTU1NfXs504E+w3DgeHZmVlJQJ1fn4e+w0VwSPQBvyG0MGPMKhleXn59PQ0pihUJycnS0tLLu+Z0NDQL/PgDc7Pz9mcqaqqEpttdnYW8WVlZeiDGE9JSYmvry8zxnWMpw8PDxhDIfr6+ji+ZxITE6UBg4L5o5LKyp/1bDiu6OhoxINsRBtVVFSYMaQZjIce7O7u8ni82NhYjtuZhISEL886NTUVzYs02fb39/39/dmeyclJEI9MMzMzh4aG6urqIiMj5dLOLC8vS0gCujOFQcze3r6oqEhsKhyLpqYmiQfjkSEmJoYEXF5empqa6urq4uaRSzvj6enZ09PDjB0dHXNzc9PS0nAtYGphYQH9YRhMzNzcHNUiNhUuHMga5CsqKgqKDKloa2sjZQbT19fHXkAYsEdybDS3trZAUDLFe6CRgfh+jIRYS+4ph4eHoYEk2+npKfups7MzBE3WRvObXbNcDc0OETeZwHBwaXJr+Lhob2/f29v70S9Nzg3KnpSUNDo6itqT4aL8nWAgYugJdnZ2mNbm/wYDDOhE6Z+aKBgKhoKhYCgYCuaH/gsgEAgUA8y7AAMADA24hckBBEQAAAAASUVORK5CYII="},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:a,Recaptcha:o,Agreements:n}}}=await import(window.geneCheckout.main);this.Agreements=n,this.ErrorMessage=e,this.RadioButton=a,this.Recaptcha=o,this.PrivacyPolicy=t},async created(){const[e,t,a,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await a.getInitialConfig(),await o.getCart(),this.renderApplePayButton(),this.open&&await this.selectPaymentMethod()},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_applepay"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},methods:{...a(o,["makePayment","mapAppleAddress"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.geneCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_applepay")},async renderApplePayButton(){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),a={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.apple.paymentAction,pageType:"checkout",environment:this.environment,currency:t.currencyCode,buyerCountry:this.buyerCountry},...{getPaymentRequest:e=>this.getPaymentRequest(e),onShippingContactSelect:(e,t)=>this.onShippingContactSelect(e,t),onShippingMethodSelect:(e,t)=>this.onShippingMethodSelect(e,t),onPaymentAuthorized:(e,t,a)=>this.onPaymentAuthorized(e,t,a),onValidate:()=>this.onValidate()}};e.applePayment(a,"ppcp-apple-pay")},async onValidate(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.usePaymentStore","stores.useRecaptchaStore"]);t.setErrorMessage("");const o=e.validateAgreements(),n=await a.validateToken("placeOrder");return o&&n},async getPaymentRequest(e){this.applePayAvailable=!0;const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),{countryCode:o,merchantCapabilities:n,supportedNetworks:s}=e;return{countryCode:o,currencyCode:a.currencyCode,merchantCapabilities:n,supportedNetworks:s,requiredBillingContactFields:["name","phone","email","postalAddress"],requiredShippingContactFields:[],total:{label:this.apple.merchantName,amount:(t.cartGrandTotal/100).toString(),type:"final"}}},async onPaymentAuthorized(e,t,a){const[o,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),{billingContact:s}=e.payment,i=await this.mapAppleAddress(s,o.cart.email,o.cart.shipping_addresses[0]?.telephone||o.cart.billing_address?.telephone);if(!n.countries.some((({id:e})=>e===i.country_code)))return void t.completePayment(window.ApplePaySession.STATUS_FAILURE);const p=await h(this.method);[this.orderID]=JSON.parse(p),a.confirmOrder({orderId:this.orderID,token:e.payment.token,billingContact:e.payment.billingContact}).then((async()=>{try{this.makePayment(o.cart.email,this.orderID,this.method,!1).then((async()=>{t.completePayment(window.ApplePaySession.STATUS_SUCCESS),window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}))}catch(e){console.log(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE)}})).catch((e=>{e&&(console.error("Error confirming order with applepay token"),console.error(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE))}))},onShippingContactSelect(){},onShippingMethodSelect(){}}};const m=["src"],u={key:1,class:"apple-pay-content"},g={class:"recaptcha"};y.render=function(e,t,a,o,h,y){return h.applePayAvailable?(d(),n("div",{key:0,class:l([{active:h.isMethodSelected},"apple-pay-container"])},[s("div",{class:l(["apple-pay-title",h.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>y.selectPaymentMethod&&y.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>y.selectPaymentMethod&&y.selectPaymentMethod(...e))},[(d(),i(p(h.RadioButton),{id:"apple-pay-select",text:e.apple.title,checked:h.isMethodSelected,"data-cy":"apple-pay-radio",class:"apple-pay-radio",onClick:y.selectPaymentMethod,onKeydown:y.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"])),s("img",{width:"48px",class:"apple-pay-logo",src:y.applePayLogo,alt:"apple-pay-logo"},null,8,m)],34),s("div",{style:r({display:h.isMethodSelected?"block":"none"}),id:"ppcp-apple-pay",class:l(["ppcp-apple-pay-container",!h.applePayLoaded&&h.isMethodSelected?"text-loading":""]),"data-cy":"checkout-PPCPApplePay"},null,6),h.errorMessage?(d(),i(p(h.ErrorMessage),{key:0,message:h.errorMessage,attached:!1},null,8,["message"])):c("v-if",!0),h.isMethodSelected?(d(),n("div",u,[(d(),i(p(h.PrivacyPolicy))),s("div",g,[h.isRecaptchaVisible("placeOrder")?(d(),i(p(h.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPaymentApple"})):c("v-if",!0)]),(d(),i(p(h.Agreements),{id:"ppcp-checkout-apple-pay"}))])):c("v-if",!0)],2)):c("v-if",!0)},y.__file="src/components/PaymentPage/PaymentMethods/ApplePay/ApplePay.vue";export{y as default};

import{p as e}from"../../../../index-esHGRNzX.min.js";import{m as t,a,g as o,P as s,c as n,h as i,d as p,f as l,n as r,i as c,b as d,o as h}from"../../../../createPPCPPaymentRest-DrWsrT7y.min.js";var y={name:"PpcpApplePayPayment",data:()=>({isMethodSelected:!1,applePayLoaded:!1,applePayAvailable:!1,applePayConfig:null,isEligible:!1,errorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_applepay",method:"ppcp_applepay",isRecaptchaVisible:()=>{},orderID:null}),props:{open:{type:Boolean,required:!1}},computed:{...t(s,["apple","environment","buyerCountry","productionClientId","sandboxClientId"]),applePayLogo:()=>"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAsCAIAAABT1onSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABB5JREFUeNrsWVkodVEUds1zhogHQ5QpkSljhlzxwBOF8mAmKckQHhAPpEzFi4wPZhHyZshQCtf04NEQkSmZXfNXp/Z/uq7rXv+5fv9tr1J7r7P2cr691/ftdeCtrKwoKYqp4sfDw0MBkAgEAmUlBTIKhoKhYCgYCoaCoWB+Aszg4GB2dvbj4+Mv6s2+Z6WlpZWVlYaGhk1NTR+fon/t7+8/Pj5+fn5WU1Nzd3fPycn5pSczMzMDJBhMTEyIDUhJSRkYGLC1tXVwcNDT02ttbQXsjY0N+aLBFr7Jbg0NDQEBAYuLi58FuLi4NDc3sz1xcXH4dff392/yMQCR9mReX1+rq6u9vb2DgoJQVxjk5+ePj4+jfvh8fldXl0i8hobG2dkZ29Pb2wtnS0vLP+bM7e2tn5/f5uYmM52bm9PS0sIek4CpqanV1dXGxkbJedzc3JhKOzo66uzsXFtbA6MiIiLS09PhXFhYwDQ4OFhkFfx4gfDwcG44k5eXR5AwxkYCMzMzi4+P/zLP4eGhq6srBsnJySCbnZ2djY1NcXFxWFgYnCcnJyEhIXd3dyKrAgMDAZszzqirq0tOMjY2JrIEX6+1tbVsT3d3NyIvLi4wPjg4IH6hUAg/ChVjiAREkr2qo6PDwMBASs5IBUYyEijvzc2NyBIfHx8UD2hzdXW1vr5eUFDA0EZs/qysLJAQAyAxNjZmPwInMzIypASj+ve0gzbgjXV0dNhOExMTXKnb29vX19dPT09GRkZLS0teXl7sGIghPtxxViChtbU1PIWFhRUVFZiitDDFASLDyMgIlwKgra39sZSJvby81NTU1NfXs504E+w3DgeHZmVlJQJ1fn4e+w0VwSPQBvyG0MGPMKhleXn59PQ0pihUJycnS0tLLu+Z0NDQL/PgDc7Pz9mcqaqqEpttdnYW8WVlZeiDGE9JSYmvry8zxnWMpw8PDxhDIfr6+ji+ZxITE6UBg4L5o5LKyp/1bDiu6OhoxINsRBtVVFSYMaQZjIce7O7u8ni82NhYjtuZhISEL886NTUVzYs02fb39/39/dmeyclJEI9MMzMzh4aG6urqIiMj5dLOLC8vS0gCujOFQcze3r6oqEhsKhyLpqYmiQfjkSEmJoYEXF5empqa6urq4uaRSzvj6enZ09PDjB0dHXNzc9PS0nAtYGphYQH9YRhMzNzcHNUiNhUuHMga5CsqKgqKDKloa2sjZQbT19fHXkAYsEdybDS3trZAUDLFe6CRgfh+jIRYS+4ph4eHoYEk2+npKfups7MzBE3WRvObXbNcDc0OETeZwHBwaXJr+Lhob2/f29v70S9Nzg3KnpSUNDo6itqT4aL8nWAgYugJdnZ2mNbm/wYDDOhE6Z+aKBgKhoKhYCgYCuaH/gsgEAgUA8y7AAMADA24hckBBEQAAAAASUVORK5CYII="},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:a,Recaptcha:o,Agreements:s}}}=await import(window.geneCheckout.main);this.Agreements=s,this.ErrorMessage=e,this.RadioButton=a,this.Recaptcha=o,this.PrivacyPolicy=t},async created(){const[e,t,a,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await a.getInitialConfig(),await o.getCart(),this.renderApplePayButton(),this.open&&await this.selectPaymentMethod()},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_applepay"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},methods:{...a(s,["makePayment","mapSelectedAddress","mapAppleAddress"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.geneCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_applepay")},async renderApplePayButton(){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),a={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.apple.paymentAction,pageType:"checkout",environment:this.environment,currency:t.currencyCode,buyerCountry:this.buyerCountry},...{getPaymentRequest:e=>this.getPaymentRequest(e),onShippingContactSelect:(e,t)=>this.onShippingContactSelect(e,t),onShippingMethodSelect:(e,t)=>this.onShippingMethodSelect(e,t),onPaymentAuthorized:(e,t,a)=>this.onPaymentAuthorized(e,t,a),onValidate:()=>this.onValidate()}};e.applePayment(a,"ppcp-apple-pay")},async onValidate(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.usePaymentStore","stores.useRecaptchaStore"]);t.setErrorMessage("");const o=e.validateAgreements(),s=await a.validateToken("placeOrder");return o&&s},async getPaymentRequest(e){this.applePayAvailable=!0;const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),{countryCode:o,merchantCapabilities:s,supportedNetworks:n}=e;return{countryCode:o,currencyCode:a.currencyCode,merchantCapabilities:s,supportedNetworks:n,requiredBillingContactFields:["name","phone","email","postalAddress"],requiredShippingContactFields:[],total:{label:this.apple.merchantName,amount:(t.cartGrandTotal/100).toString(),type:"final"}}},async onPaymentAuthorized(e,t,a){const[s,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),{billingContact:i}=e.payment,p=await this.mapAppleAddress(i,s.cart.email,s.cart.shipping_addresses[0].telephone);let l=null;if(s.cart.is_virtual||(l=await this.mapSelectedAddress(s.cart.shipping_addresses[0])),!n.countries.some((({id:e})=>e===p.country_code)))return void t.completePayment(window.ApplePaySession.STATUS_FAILURE);const r=await o(this.method);[this.orderID]=JSON.parse(r),a.confirmOrder({orderId:this.orderID,token:e.payment.token,billingContact:e.payment.billingContact}).then((async()=>{try{window.geneCheckout.services.setAddressesOnCart(l,p,s.cart.email).then((()=>this.makePayment(s.cart.email,this.orderID,this.method,!1))).then((async()=>{t.completePayment(window.ApplePaySession.STATUS_SUCCESS),window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}))}catch(e){console.log(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE)}})).catch((e=>{e&&(console.error("Error confirming order with applepay token"),console.error(e),t.completePayment(window.ApplePaySession.STATUS_FAILURE))}))},onShippingContactSelect(){},onShippingMethodSelect(){}}};const m=["src"],u={key:1,class:"apple-pay-content"},g={class:"recaptcha"};y.render=function(e,t,a,o,s,y){return s.applePayAvailable?(h(),n("div",{key:0,class:r([{active:s.isMethodSelected},"apple-pay-container"])},[i("div",{class:r(["apple-pay-title",s.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>y.selectPaymentMethod&&y.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>y.selectPaymentMethod&&y.selectPaymentMethod(...e))},[(h(),p(l(s.RadioButton),{id:"apple-pay-select",text:e.apple.title,checked:s.isMethodSelected,"data-cy":"apple-pay-radio",class:"apple-pay-radio",onClick:y.selectPaymentMethod,onKeydown:y.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"])),i("img",{width:"48px",class:"apple-pay-logo",src:y.applePayLogo,alt:"apple-pay-logo"},null,8,m)],34),i("div",{style:c({display:s.isMethodSelected?"block":"none"}),id:"ppcp-apple-pay",class:r(["ppcp-apple-pay-container",!s.applePayLoaded&&s.isMethodSelected?"text-loading":""]),"data-cy":"checkout-PPCPApplePay"},null,6),s.errorMessage?(h(),p(l(s.ErrorMessage),{key:0,message:s.errorMessage,attached:!1},null,8,["message"])):d("v-if",!0),s.isMethodSelected?(h(),n("div",u,[(h(),p(l(s.PrivacyPolicy))),i("div",g,[s.isRecaptchaVisible("placeOrder")?(h(),p(l(s.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPaymentApple"})):d("v-if",!0)]),(h(),p(l(s.Agreements),{id:"ppcp-checkout-apple-pay"}))])):d("v-if",!0)],2)):d("v-if",!0)},y.__file="src/components/PaymentPage/PaymentMethods/ApplePay/ApplePay.vue";export{y as default};

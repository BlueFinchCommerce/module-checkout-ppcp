import{p as e}from"../../../../index-qW3CXwUR.min.js";import{m as t,a as o,P as n,c as a,d as s,e as r,g as i,n as c,b as l,h as d,o as h}from"../../../../PpcpStore-B-5sz8Dd.min.js";import{c as m}from"../../../../createPPCPPaymentRest-UEvEk5W3.min.js";import{i as p}from"../../../../venmo_logo_blue-DcKUhyRc.min.js";var u={name:"PpcpVenmoPayment",props:{open:{type:Boolean,required:!1}},data:()=>({isMethodSelected:!1,methodEligible:!0,errorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_venmo",method:"ppcp_venmo",isRecaptchaVisible:()=>{},orderID:null,venmoLoaded:!1,checkboxComponent:null,storeMethod:!1,isLoggedIn:!1}),computed:{...t(n,["venmo","paypal","environment","buyerCountry","productionClientId","sandboxClientId"]),venmoLogo:()=>p},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_venmo"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:o,Recaptcha:n,Agreements:a,Checkbox:s}}}=await import(window.bluefinchCheckout.main);this.Agreements=a,this.ErrorMessage=e,this.RadioButton=o,this.Recaptcha=n,this.PrivacyPolicy=t,this.checkboxComponent=s},async created(){const[e,t,o,n,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore","stores.useCustomerStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,this.isLoggedIn=a.isLoggedIn,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await o.getInitialConfig(),await n.getCart(),await this.renderVenmoInstance(),this.open&&await this.selectPaymentMethod()},methods:{...o(n,["makePayment"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.bluefinchCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_venmo")},async renderVenmoInstance(){const t=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),o=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),n=this,a={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:o.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:t.currencyCode,buttonStyles:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},buttonHeight:40},...{createOrder:()=>this.createOrder(n),onApprove:()=>this.onApprove(n),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e),isPaymentMethodEligible:e=>this.isPaymentMethodEligible(e)}};e.venmoPayment(a,"paypal-button-container-venmo"),this.venmoLoaded=!0},isPaymentMethodEligible(e){this.methodEligible=e},createOrder:async e=>{try{const t=await m(e.method,e.venmo.vaultActive,1),o=JSON.parse(t),[n]=o;return e.orderID=n,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,o,n]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useAgreementStore","stores.useLoadingStore","stores.useRecaptchaStore"]);e.setErrorMessage("");const a=t.validateAgreements(),s=await n.validateToken("placeOrder");return!(!a||!s)&&(o.setLoadingState(!0),!0)},onApprove:async e=>{const[t,o,n]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore","stores.useCartStore"]);return e.makePayment(n.cart.email,e.orderID,e.method,!1,e.storeMethod).then((()=>{e.redirectToSuccess()})).catch((e=>{o.setLoadingState(!1);try{window.bluefinchCheckout.helpers.handleServiceError(e)}catch(e){t.setErrorMessage(e)}}))},onCancel:async()=>{(await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useLoadingStore"])).setLoadingState(!1)},onError:async e=>{const[t,o]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);o.setLoadingState(!1),t.setErrorMessage(e)},redirectToSuccess(){window.location.href=window.bluefinchCheckout.helpers.getSuccessPageUrl()}}};const y=["src"],v={key:1,class:"venmo-content"},g={class:"recaptcha"};u.render=function(e,t,o,n,m,p){return m.methodEligible?(h(),a("div",{key:0,class:c([{active:m.isMethodSelected},"venmo-container"])},[s("div",{class:c(["venmo-title",m.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e))},[(h(),r(i(m.RadioButton),{id:"venmo-select",text:e.venmo.title,checked:m.isMethodSelected,"data-cy":"venmo-radio",class:"venmo-radio",onClick:p.selectPaymentMethod,onKeydown:p.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"])),s("img",{width:"48px",class:"venmo-logo",src:p.venmoLogo,alt:"venmo-logo"},null,8,y)],34),m.errorMessage?(h(),r(i(m.ErrorMessage),{key:0,message:m.errorMessage,attached:!1},null,8,["message"])):l("v-if",!0),s("div",{id:"paypal-button-container-venmo",style:d({display:m.isMethodSelected?"block":"none"}),class:c(["paypal-button-container",m.venmoLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPalVenmo"},null,6),m.isMethodSelected?(h(),a("div",v,[s("div",g,[m.isRecaptchaVisible("placeOrder")?(h(),r(i(m.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPaymentVenmo"})):l("v-if",!0)]),m.isLoggedIn&&"ppcp_venmo"===m.selectedMethod&&e.venmo.vaultActive?(h(),r(i(m.checkboxComponent),{key:0,id:"ppcp-store-method",class:"ppcp-store-method",checked:m.storeMethod,"change-handler":({currentTarget:e})=>m.storeMethod=e.checked,text:"Save for later use.","data-cy":"ppcp-save-payment-venmo-checkbox"},null,8,["checked","change-handler"])):l("v-if",!0),(h(),r(i(m.PrivacyPolicy))),(h(),r(i(m.Agreements),{id:"ppcp-checkout-venmo"}))])):l("v-if",!0)],2)):l("v-if",!0)},u.__file="src/components/PaymentPage/PaymentMethods/Venmo/Venmo.vue";export{u as default};

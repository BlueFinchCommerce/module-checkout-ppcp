import{p as e}from"../../../../index-BN2YhhzG.min.js";import{m as t,a as o,g as n,P as a,c as s,h as r,d as c,f as i,n as d,b as l,i as h,o as m}from"../../../../createPPCPPaymentRest-DrWsrT7y.min.js";import{i as p}from"../../../../venmo_logo_blue-DcKUhyRc.min.js";var u={name:"PpcpVenmoPayment",props:{open:{type:Boolean,required:!1}},data:()=>({isMethodSelected:!1,errorMessage:"",ErrorMessage:null,PrivacyPolicy:null,RadioButton:null,Recaptcha:null,Agreements:null,paymentEmitter:null,isPaymentMethodAvailable:null,selectedMethod:"ppcp_venmo",method:"ppcp_venmo",isRecaptchaVisible:()=>{},orderID:null,venmoLoaded:!1,checkboxComponent:null,storeMethod:!1,isLoggedIn:!1}),computed:{...t(a,["venmo","paypal","environment","buyerCountry","productionClientId","sandboxClientId"]),venmoLogo:()=>p},watch:{selectedMethod:{handler(e){null!==e&&"ppcp_venmo"!==e&&(this.isMethodSelected=!1)},immediate:!0,deep:!0}},async mounted(){const{default:{components:{ErrorMessage:e,PrivacyPolicy:t,RadioButton:o,Recaptcha:n,Agreements:a,Checkbox:s}}}=await import(window.geneCheckout.main);this.Agreements=a,this.ErrorMessage=e,this.RadioButton=o,this.Recaptcha=n,this.PrivacyPolicy=t,this.checkboxComponent=s},async created(){const[e,t,o,n,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useRecaptchaStore","stores.usePaymentStore","stores.useConfigStore","stores.useCartStore","stores.useCustomerStore"]);this.paymentEmitter=t.paymentEmitter,this.isPaymentMethodAvailable=t.isPaymentMethodAvailable,this.isRecaptchaVisible=e.isRecaptchaVisible,this.isLoggedIn=a.isLoggedIn,t.$subscribe((e=>{void 0!==e.payload.selectedMethod&&(this.selectedMethod=e.payload.selectedMethod)})),this.paymentEmitter.on("changePaymentMethodDisplay",(({visible:e})=>{this.paymentVisible=e})),await o.getInitialConfig(),await n.getCart(),await this.renderVenmoInstance(),this.open&&await this.selectPaymentMethod()},methods:{...o(a,["makePayment"]),async selectPaymentMethod(){this.isMethodSelected=!0;(await window.geneCheckout.helpers.loadFromCheckout("stores.usePaymentStore")).selectPaymentMethod("ppcp_venmo")},async renderVenmoInstance(){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),o=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),n=this,a={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:o.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:t.currencyCode,buttonStyles:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},buttonHeight:40},...{createOrder:()=>this.createOrder(n),onApprove:()=>this.onApprove(n),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e)}};e.venmoPayment(a,"paypal-button-container-venmo"),this.venmoLoaded=!0},createOrder:async e=>{try{const t=await n(e.method,e.venmo.vaultActive,1),o=JSON.parse(t),[a]=o;return e.orderID=a,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,o,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useAgreementStore","stores.useLoadingStore","stores.useRecaptchaStore"]);e.setErrorMessage("");const a=t.validateAgreements(),s=await n.validateToken("placeOrder");return!(!a||!s)&&(o.setLoadingState(!0),!0)},onApprove:async e=>{const[t,o,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore","stores.useCartStore"]);return e.makePayment(n.cart.email,e.orderID,e.method,!1,e.storeMethod).then((()=>{e.redirectToSuccess()})).catch((e=>{o.setLoadingState(!1);try{window.geneCheckout.helpers.handleServiceError(e)}catch(e){t.setErrorMessage(e)}}))},onCancel:async()=>{(await window.geneCheckout.helpers.loadFromCheckout(["stores.useLoadingStore"])).setLoadingState(!1)},onError:async e=>{const[t,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);o.setLoadingState(!1),t.setErrorMessage(e)},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};const y=["src"],g={key:1,class:"venmo-content"},v={class:"recaptcha"};u.render=function(e,t,o,n,a,p){return m(),s("div",{class:d([{active:a.isMethodSelected},"venmo-container"])},[r("div",{class:d(["venmo-title",a.isMethodSelected?"selected":""]),onClick:t[0]||(t[0]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e)),onKeydown:t[1]||(t[1]=(...e)=>p.selectPaymentMethod&&p.selectPaymentMethod(...e))},[(m(),c(i(a.RadioButton),{id:"venmo-select",text:e.venmo.title,checked:a.isMethodSelected,"data-cy":"venmo-radio",class:"venmo-radio",onClick:p.selectPaymentMethod,onKeydown:p.selectPaymentMethod},null,40,["text","checked","onClick","onKeydown"])),r("img",{width:"48px",class:"venmo-logo",src:p.venmoLogo,alt:"venmo-logo"},null,8,y)],34),a.errorMessage?(m(),c(i(a.ErrorMessage),{key:0,message:a.errorMessage,attached:!1},null,8,["message"])):l("v-if",!0),r("div",{id:"paypal-button-container-venmo",style:h({display:a.isMethodSelected?"block":"none"}),class:d(["paypal-button-container",a.venmoLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPalVenmo"},null,6),a.isMethodSelected?(m(),s("div",g,[r("div",v,[a.isRecaptchaVisible("placeOrder")?(m(),c(i(a.Recaptcha),{key:0,id:"placeOrder",location:"ppcpPaymentVenmo"})):l("v-if",!0)]),a.isLoggedIn&&"ppcp_venmo"===a.selectedMethod&&e.venmo.vaultActive?(m(),c(i(a.checkboxComponent),{key:0,id:"ppcp-store-method",class:"ppcp-store-method",checked:a.storeMethod,"change-handler":({currentTarget:e})=>a.storeMethod=e.checked,text:"Save for later use.","data-cy":"ppcp-save-payment-venmo-checkbox"},null,8,["checked","change-handler"])):l("v-if",!0),(m(),c(i(a.PrivacyPolicy))),(m(),c(i(a.Agreements),{id:"ppcp-checkout-venmo"}))])):l("v-if",!0)],2)},u.__file="src/components/PaymentPage/PaymentMethods/Venmo/Venmo.vue";export{u as default};

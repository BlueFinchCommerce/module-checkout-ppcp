import{m as e,b as t,u as a,c as s,e as o,n as r,F as n,o as i}from"../../../PpcpStore-CjZ5dkQx.min.js";import{c as p,l as d}from"../../../createPPCPPaymentRest-Ci5Dx8PK.min.js";var c=async(e,t,a,s)=>{const o={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};s&&(r.shipping_carrier_code=t,r.shipping_method_code=a);try{return(await window.geneCheckout.services.authenticatedRequest().post(window.geneCheckout.helpers.buildCartUrl("totals-information"),r,{headers:o})).data}catch(e){return console.log(e),null}},h={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,address:{}}),computed:{...e(a,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))?(await this.getInitialConfigValues(),await this.addScripts(),this.namespace=`${this.namespace}`,this.paypal.payLaterActive&&(this.namespace=`${this.method}_paylater`),await this.renderPaypalInstance()):(t.removeExpressMethod(this.key),this.paypalLoaded=!0)},methods:{...t(a,["getInitialConfigValues"]),async addScripts(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=d(),a={intent:this.paypal.paymentAction,currency:e.currencyCode,components:"buttons"};return"sandbox"===this.environment?(a["buyer-country"]=this.buyerCountry,a["client-id"]=this.sandboxClientId):a["client-id"]=this.productionClientId,this.paypal.payLaterMessageActive&&(a.components+=",messages"),this.paypal.payLaterActive&&(a["enable-funding"]="paylater"),t("https://www.paypal.com/sdk/js",a,"ppcp_paypal")},async renderPaypalInstance(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),t={env:this.environment,commit:!0,style:{label:this.paypal.buttonLabel,size:"responsive",shape:this.paypal.buttonShape,color:this.paypal.buttonColor,tagline:!1},fundingSource:this.paypal.payLaterActive?window[`paypal_${this.method}`].FUNDING.PAYLATER:window[`paypal_${this.method}`].FUNDING.PAYPAL,createOrder:async()=>{try{const e=await p(this.method),t=JSON.parse(e),[a]=t;return this.orderID=a,this.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,a,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!a.validateAgreements()&&(await t.setNotClickAndCollect(),s.setLoadingState(!0),!0)},onShippingAddressChange:async e=>(this.address=await this.mapAddress(e.shippingAddress),c(this.address,"","",!1).then((async()=>(async(e,t,a)=>{const s=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),o={"X-Requested-With":"XMLHttpRequest"},r={orderId:e,shippingAddress:t,method:a};try{return(await window.geneCheckout.services.authenticatedRequest().post("ppcp/changeShippingAddress",r,{headers:o})).data}catch(e){return s.setPaymentErrorMessage(e.response.data.message),null}})(this.orderID,JSON.stringify(e.shippingAddress),this.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async e=>{const[t,...a]=e.selectedShippingOption.id.split("_");return c(this.address,t,a.join("_"),!0).then((async()=>(async(e,t,a)=>{const s=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),o={"X-Requested-With":"XMLHttpRequest"},r={orderId:e,shippingMethod:t,method:a};try{return(await window.geneCheckout.services.authenticatedRequest().post("ppcp/changeShippingMethod",r,{headers:o})).data}catch(e){return s.setPaymentErrorMessage(e.response.data.message),null}})(this.orderID,JSON.stringify(e.selectedShippingOption),this.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async()=>{try{await(async e=>{const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),a={"X-Requested-With":"XMLHttpRequest"};try{return(await window.geneCheckout.services.authenticatedRequest().post("ppcp/finishOrder",e,{headers:a})).data}catch(e){return t.setPaymentErrorMessage(e.response.data.message),null}})({orderId:this.orderID,method:this.method}).then((()=>{window.geneCheckout.services.refreshCustomerData(["cart"]),this.redirectToSuccess()}))}catch(e){const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}},a={...t,fundingSource:window[`paypal_${this.method}`].FUNDING.PAYPAL};if(await window[`paypal_${this.method}`].Buttons(a).render("#ppcp-paypal_ppcp_paypal"),this.paypal.payLaterActive){const e={...t,fundingSource:window[`paypal_${this.method}`].FUNDING.PAYLATER,style:{...t.style,color:this.paypal.payLaterButtonColour,shape:this.paypal.payLaterButtonShape}};await window[`paypal_${this.method}`].Buttons(e).render("#ppcp-paypal_ppcp_paylater")}const s={amount:e.cart.total,style:{layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}}};this.paypal.payLaterMessageActive&&await window[`paypal_${this.method}`].Messages(s).render("#ppcp-paypal_messages"),this.paypalLoaded=!0},async mapAddress(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};h.render=function(e,t,a,p,d,c){return i(),s(n,null,[o("div",{class:r(["paypal-button-container",d.paypalLoaded?"":"text-loading"]),id:"ppcp-paypal_ppcp_paypal","data-cy":"instant-checkout-ppcpPayPal"},null,2),o("div",{class:r(["paypal-button-container",d.paypalLoaded?"":"text-loading"]),id:"ppcp-paypal_ppcp_paylater","data-cy":"instant-checkout-ppcpPayLater"},null,2),o("div",{class:r([d.paypalLoaded?"":"text-loading","paypal-messages-container"]),id:"ppcp-paypal_messages","data-cy":"instant-checkout-ppcpMessages"},null,2)],64)},h.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{h as default};

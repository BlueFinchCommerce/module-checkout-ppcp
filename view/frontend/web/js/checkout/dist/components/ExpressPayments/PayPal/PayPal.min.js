import{p as e}from"../../../index-BN2YhhzG.min.js";import{P as t,m as a,a as s,g as o,c as r,h as n,n as i,F as p,o as d}from"../../../createPPCPPaymentRest-CqcTBFKR.min.js";var c=async(e,t,a,s)=>{const o={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};s&&(r.shipping_carrier_code=t,r.shipping_method_code=a);try{return(await window.geneCheckout.services.authenticatedRequest().post(window.geneCheckout.helpers.buildCartUrl("totals-information"),r,{headers:o})).data}catch(e){return console.log(e),null}},l={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,address:{}}),computed:{...a(t,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))&&(await this.getInitialConfigValues(),this.paypal.showOnTopCheckout?(await this.renderPaypalInstance(),await this.waitForButtonsToRender(),this.paypalLoaded=!0):(t.removeExpressMethod(this.key),this.paypalLoaded=!0))},methods:{...s(t,["getInitialConfigValues"]),async waitForButtonsToRender(){const e=document.querySelectorAll(".paypal-express--button-container");return new Promise((t=>{const a=setInterval((()=>{Array.from(e).every((e=>e.children.length>0))&&(clearInterval(a),t())}),100)}))},async renderPaypalInstance(){const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),s=this,o={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:t.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:a.currencyCode,isPayLaterEnabled:this.paypal.payLaterActive,isPayLaterMessagingEnabled:this.paypal.payLaterMessageActive,messageStyles:{layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}},buttonStyles:{paypal:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},paylater:{buttonShape:this.paypal.payLaterButtonShape,buttonColor:this.paypal.payLaterButtonColour}},buttonHeight:40},...{createOrder:()=>this.createOrder(s),onApprove:()=>this.onApprove(s),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e),onShippingAddressChange:e=>this.onShippingAddressChange(s,e),onShippingOptionsChange:e=>this.onShippingOptionsChange(s,e)}};e.paypalButtons(o,"ppcp-express")},createOrder:async e=>{try{const t=await o(e.method),a=JSON.parse(t),[s]=a;return e.orderID=s,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,a,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!a.validateAgreements()&&(await t.setNotClickAndCollect(),s.setLoadingState(!0),!0)},onShippingAddressChange:async(e,a)=>(e.address=await e.mapAddress(a.shippingAddress),c(e.address,"","",!1).then((async()=>(async(e,a,s)=>{const o=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=t(),i=n.changeShippingAddressUrl,p={orderId:e,shippingAddress:a,method:s};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,p,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(e.orderID,JSON.stringify(a.shippingAddress),e.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async(e,a)=>{const[s,...o]=a.selectedShippingOption.id.split("_");return c(e.address,s,o.join("_"),!0).then((async()=>(async(e,a,s)=>{const o=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=t(),i=n.changeShippingMethodUrl,p={orderId:e,shippingMethod:a,method:s};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,p,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(e.orderID,JSON.stringify(a.selectedShippingOption),e.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async e=>{const[a,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);try{const o=await(async e=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),s={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:o}=t(),r=o.finishOrderUrl;try{return(await window.geneCheckout.services.authenticatedRequest().post(r,e,{headers:s})).data}catch(e){return a.setPaymentErrorMessage(e.message),null}})({orderId:e.orderID,method:e.method});null!==o?e.redirectToSuccess():(s.setLoadingState(!1),a.setErrorMessage("Something went wrong. Please check your address."))}catch(e){s.setLoadingState(!1),a.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)},async mapAddress(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};l.render=function(e,t,a,s,o,c){return d(),r(p,null,[n("div",{id:"ppcp-express-paypal",class:i(["paypal-express--button-container",o.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPal"},null,2),n("div",{id:"ppcp-express-paylater",class:i(["paypal-express--button-container",o.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayLater"},null,2),n("div",{id:"ppcp-express-messages",class:i([o.paypalLoaded?"":"text-loading","paypal-messages-container"]),"data-cy":"instant-checkout-ppcpMessages"},null,2)],64)},l.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{l as default};

import{P as e,m as t,a,c as s,h as o,n as r,F as n,o as p}from"../../../PpcpStore-Dc8hu8rx.min.js";import{c as i,l as d}from"../../../createPPCPPaymentRest-DUkFikGQ.min.js";var c=async(e,t,a,s)=>{const o={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};s&&(r.shipping_carrier_code=t,r.shipping_method_code=a);try{return(await window.geneCheckout.services.authenticatedRequest().post(window.geneCheckout.helpers.buildCartUrl("totals-information"),r,{headers:o})).data}catch(e){return console.log(e),null}},h={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,address:{}}),computed:{...t(e,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))?(await this.getInitialConfigValues(),await this.addScripts(),this.namespace=`${this.namespace}`,this.paypal.payLaterActive&&(this.namespace=`${this.method}_paylater`),await this.renderPaypalInstance()):(t.removeExpressMethod(this.key),this.paypalLoaded=!0)},methods:{...a(e,["getInitialConfigValues"]),async addScripts(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=d(),a={intent:this.paypal.paymentAction,currency:e.currencyCode,components:"buttons"};return"sandbox"===this.environment?(a["buyer-country"]=this.buyerCountry,a["client-id"]=this.sandboxClientId):a["client-id"]=this.productionClientId,this.paypal.payLaterMessageActive&&(a.components+=",messages"),this.paypal.payLaterActive&&(a["enable-funding"]="paylater"),t("https://www.paypal.com/sdk/js",a,"ppcp_paypal")},async renderPaypalInstance(){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),a={env:this.environment,commit:!0,style:{label:this.paypal.buttonLabel,size:"responsive",shape:this.paypal.buttonShape,color:this.paypal.buttonColor,tagline:!1},fundingSource:this.paypal.payLaterActive?window[`paypal_${this.method}`].FUNDING.PAYLATER:window[`paypal_${this.method}`].FUNDING.PAYPAL,createOrder:async()=>{try{const e=await i(this.method),t=JSON.parse(e),[a]=t;return this.orderID=a,this.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,a,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!a.validateAgreements()&&(await t.setNotClickAndCollect(),s.setLoadingState(!0),!0)},onShippingAddressChange:async t=>(this.address=await this.mapAddress(t.shippingAddress),c(this.address,"","",!1).then((async()=>(async(t,a,s)=>{const o=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=e(),p=n.changeShippingAddressUrl,i={orderId:t,shippingAddress:a,method:s};try{return(await window.geneCheckout.services.authenticatedRequest().post(p,i,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(this.orderID,JSON.stringify(t.shippingAddress),this.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async t=>{const[a,...s]=t.selectedShippingOption.id.split("_");return c(this.address,a,s.join("_"),!0).then((async()=>(async(t,a,s)=>{const o=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=e(),p=n.changeShippingMethodUrl,i={orderId:t,shippingMethod:a,method:s};try{return(await window.geneCheckout.services.authenticatedRequest().post(p,i,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(this.orderID,JSON.stringify(t.selectedShippingOption),this.method))).catch((async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async()=>{try{await(async t=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),s={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:o}=e(),r=o.finishOrderUrl;try{return(await window.geneCheckout.services.authenticatedRequest().post(r,t,{headers:s})).data}catch(e){return a.setPaymentErrorMessage(e.response.data.message),null}})({orderId:this.orderID,method:this.method}).then((()=>{this.redirectToSuccess()}))}catch(e){const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}},s={...a,fundingSource:window[`paypal_${this.method}`].FUNDING.PAYPAL};if(await window[`paypal_${this.method}`].Buttons(s).render("#ppcp-express-paypal_ppcp_paypal"),this.paypal.payLaterActive){const e={...a,fundingSource:window[`paypal_${this.method}`].FUNDING.PAYLATER,style:{...a.style,color:this.paypal.payLaterButtonColour,shape:this.paypal.payLaterButtonShape}};await window[`paypal_${this.method}`].Buttons(e).render("#ppcp-express-paypal_ppcp_paylater")}const o={amount:t.cart.total,style:{layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}}};this.paypal.payLaterMessageActive&&await window[`paypal_${this.method}`].Messages(o).render("#ppcp-express-paypal_messages"),this.paypalLoaded=!0},async mapAddress(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};h.render=function(e,t,a,i,d,c){return p(),s(n,null,[o("div",{class:r(["paypal-express--button-container",d.paypalLoaded?"":"text-loading"]),id:"ppcp-express-paypal_ppcp_paypal","data-cy":"instant-checkout-ppcpPayPal"},null,2),o("div",{class:r(["paypal-express--button-container",d.paypalLoaded?"":"text-loading"]),id:"ppcp-express-paypal_ppcp_paylater","data-cy":"instant-checkout-ppcpPayLater"},null,2),o("div",{class:r([d.paypalLoaded?"":"text-loading","paypal-messages-container"]),id:"ppcp-express-paypal_messages","data-cy":"instant-checkout-ppcpMessages"},null,2)],64)},h.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{h as default};

import{P as e,m as t,a as n,g as o,c as a,i as r,n as s,F as i,o as c}from"../../../createPPCPPaymentRest-bZhSKs1h.min.js";function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const d={};var l={create:(e,t,n,o,a)=>{let r=e;t&&(r=new URL(r),r.search=new URLSearchParams(t),r=decodeURIComponent(r.href));const s=((e,t,n="")=>e+t+n)(r,n,a);return d[s]||(d[s]=new Promise((e=>{const t=document.createElement("script");t.src=r,t.dataset.namespace=`paypal_${n}`,t.dataset.partnerAttributionId="GENE_PPCP",t.dataset.pageType=o||"checkout",a&&(t.dataset.userIdToken=a),t.onload=()=>{const t=new CustomEvent("ppcpScriptLoaded",{detail:n});document.dispatchEvent(t),e()},document.head.appendChild(t)}))),d[s]}};const u=l,h="ppcp_applepay_new";let y,g,m;function w(){return new Promise((e=>{const t=document.createElement("apple-pay-button");t.onclick=()=>{!function(){const e=new window.ApplePaySession(4,m),t=window[`paypal_${h}`].Applepay();e.onvalidatemerchant=n=>{t.validateMerchant({validationUrl:n.validationURL}).then((t=>{e.completeMerchantValidation(t.merchantSession)})).catch((t=>{console.error(t),e.abort()}))},e.onshippingcontactselected=t=>{y.onShippingContactSelect(t,e)},e.onshippingmethodselected=t=>{y.onShippingMethodSelect(t,e)},e.onpaymentauthorized=async n=>{y.onPaymentAuthorized(n,e,t)},e.begin()}()};document.getElementById(g).appendChild(t),e()}))}var C=function(e,t){if(!e||!t)throw new Error("Apple Pay requires both context and element.");y=e,g=t;const n={"client-id":y.clientId,intent:y.intent,components:"applepay",currency:y.currency};"sandbox"===y.environment&&(n["buyer-country"]=y.buyerCountry),u.create("https://www.paypal.com/sdk/js",n,h,y.pageType).then((()=>new Promise(((e,t)=>{"https:"!==window.location.protocol&&(console.warn("PPCP Apple Pay requires your checkout be served over HTTPS"),t()),!0!==(window.ApplePaySession&&window.ApplePaySession.canMakePayments())&&(console.warn("PPCP Apple Pay is not supported on this device/browser"),t()),window[`paypal_${h}`].Applepay().config().then((n=>{n.isEligible?(m=y.getPaymentRequest(n),e()):(console.warn("PPCP Apple Pay is not eligible"),t())})).catch((()=>{console.error("Error while fetching Apple Pay configuration."),t()})),e()})))).then((()=>w()))};const P=C,b=l;const S=l,f="ppcp_card_new";let E;function v(){if(window[`paypal_${f}`]){!function(e){const t=E.cardFields.numberField,n=E.cardFields.cvvField,o=E.cardFields.expiryField;if(e.isEligible()){const a=document.querySelector(t.id),r=document.querySelector(n.id),s=document.querySelector(o.id),i=e.NumberField({placeholder:t.placeholder,inputEvents:{onBlur:e=>t.inputEvents.blur(e,a),onFocus:()=>{}}}),c=e.CVVField({placeholder:n.placeholder,inputEvents:{onBlur:e=>n.inputEvents.blur(e,r),onFocus:()=>{}}}),p=e.ExpiryField({placeholder:o.placeholder,inputEvents:{onBlur:e=>o.inputEvents.blur(e,s),onFocus:()=>{}}});""===a.innerHTML.trim()&&i.render(t.id),""===r.innerHTML.trim()&&c.render(n.id),""===s.innerHTML.trim()&&p.render(o.id),document.querySelector(E.submitButtonId).addEventListener("click",(()=>{E.runAdditionalValidators()&&e.getState().then((t=>{if(t.isFormValid)e.submit().then((()=>{})).catch((e=>{console.error(e),E.displayErrorMessage("Cannot validate payment.")}));else{let e="";t.errors.includes("INVALID_NUMBER")&&(e+="Card number is not valid."),t.errors.includes("INVALID_EXPIRY")&&(e+=" Expiry date is not valid."),t.errors.includes("INVALID_CVV")&&(e+=" CVV is not valid."),E.displayErrorMessage(e)}}))}))}}(window[`paypal_${f}`].CardFields({createOrder:()=>E.createOrder(),onApprove:()=>E.onApprove(),onError:()=>E.onError(),style:E.style}))}else E.active(!1)}var k=function(e,t){if(!e||!t)throw new Error("Card Payments requires both context and element.");E=e;const n={"client-id":E.clientId,intent:E.intent,components:"card-fields",currency:E.currency};S.create("https://www.paypal.com/sdk/js",n,f,E.pageType).then((()=>v()))};const I=l;let L,A;function M(e){if(L.validateAdditionalValidators&&!L.validateAdditionalValidators())return!1;const t={...e},n=["PAYMENT_AUTHORIZATION"],o=L.onPaymentDataChanged;return o&&n.push("SHIPPING_ADDRESS","SHIPPING_OPTION"),t.allowedPaymentMethods=e.allowedPaymentMethods,t.transactionInfo={countryCode:e.countryCode,currencyCode:L.transactionInfo.currencyCode,totalPriceStatus:L.transactionInfo.totalPriceStatus,totalPrice:parseFloat(L.transactionInfo.totalPrice).toFixed(2)},t.merchantInfo=e.merchantInfo,t.shippingAddressRequired=!!o,t.shippingAddressParameters={phoneNumberRequired:!!o},t.emailRequired=!0,t.shippingOptionRequired=!!o,t.callbackIntents=n,delete t.countryCode,delete t.isEligible,A.loadPaymentData(t).catch((e=>{console.warn(e)}))}var _=function(e,t){if(!e||!t)throw new Error("Google Payments requires both context and element.");if("function"!=typeof e.placeOrder)return console.error("PPCP Google Pay Context passed does not provide a placeOrder method",e);L=e;const n={"client-id":L.clientId,intent:L.intent,components:"googlepay",currency:L.transactionInfo.currencyCode};"sandbox"===L.environment&&(n["buyer-country"]=L.buyerCountry),I.create("https://www.paypal.com/sdk/js",n,"ppcp_googlepay",L.pageType).then((()=>new Promise(((e,t)=>{"https:"!==window.location.protocol&&(console.warn("Google Pay requires your checkout be served over HTTPS"),t()),window.paypal_ppcp_googlepay.Googlepay().config().then((n=>{n.isEligible?(n.allowedPaymentMethods.forEach((e=>{e.parameters.billingAddressParameters.phoneNumberRequired=!0})),e(n)):t()}))})))).then((e=>function(e){const t={onPaymentAuthorized:t=>L.onPaymentAuthorized(t,e)};return L.onPaymentDataChanged&&(t.onPaymentDataChanged=t=>{L.onPaymentDataChanged(t,e)}),A=new window.google.payments.api.PaymentsClient({environment:"sandbox"===L.environment?"TEST":"PRODUCTION",paymentDataCallbacks:t}),A.isReadyToPay({apiVersion:e.apiVersion,apiVersionMinor:e.apiVersionMinor,allowedPaymentMethods:e.allowedPaymentMethods}).then((t=>t.result?e:null))}(e))).then((e=>function(e){return A.createButton({allowedPaymentMethods:e.allowedPaymentMethods,buttonColor:L.button.buttonColor.toLowerCase(),buttonSizeMode:"fill",onClick:L.beforeOnClick?()=>L.beforeOnClick().then((()=>M(e))):()=>M(e)})}(e))).then((e=>{if(e){document.getElementById(t).appendChild(e)}})).catch((e=>{console.error("Error initializing Google Pay Button:",e)}))};const x=_,O=l;const T=l,F="ppcp_paypal_new";let R,q,N;const B={};function V(){return new Promise((e=>{N.forEach((e=>{const t={createOrder:R.createOrder,onApprove:R.onApprove,onClick:R.onClick,onCancel:R.onCancel,onError:e=>R.onError(e),onShippingAddressChange:e=>R.onShippingAddressChange(e),onShippingOptionsChange:e=>R.onShippingOptionsChange(e)};t.fundingSource=e,t.style=function(e){const{[e]:{buttonColor:t,buttonLabel:n,buttonShape:o}}=R.buttonStyles||{};return{color:t,label:n,shape:o,height:R.buttonHeight?R.buttonHeight:40}}(e),t.message=function(e){if("paylater"===e&&R.isPayLaterMessagingEnabled&&"checkout"===R.pageType){const e=R.messageStyles.text||{};return{align:e.align,amount:R.amount,color:"black"!==e.color||"white"!==e.color?"black":e.color}}return null}(e),B[e]=window[`paypal_${F}`].Buttons(t)})),e()}))}var D=function(e,t){if(!e||!t)throw new Error("PaypalButtons requires both context and element.");R=e,q=t;const n={"client-id":R.productionClientId,intent:R.intent,components:"buttons",currency:R.currency};"sandbox"===R.environment&&(n["client-id"]=R.sandboxClientId,n["buyer-country"]=R.buyerCountry),R.isPayLaterMessagingEnabled&&(n.components+=",messages"),R.isPayLaterEnabled&&(n["enable-funding"]="paylater"),T.create("https://www.paypal.com/sdk/js",n,F,R.pageType).then((()=>new Promise((e=>{const t=[window[`paypal_${F}`].FUNDING.PAYPAL];R.isPayLaterEnabled&&t.push(window[`paypal_${F}`].FUNDING.PAYLATER),N=t.filter((e=>{const t=`${q}-${e}`;return document.getElementById(t)?document.getElementById(t):(console.error("Paypal button element does not exist",t),null)})),e()})))).then((()=>V())).then((()=>{Object.keys(B).forEach((e=>{const t=document.getElementById(`${q}-${e}`),n=0===t.childNodes.length;B[e].isEligible()&&t&&n&&B[e].render(t)}))})).catch((e=>{console.error("Error initializing PayPal Buttons:",e)}))};const U=D;const $=l,H="ppcp_paypal_messages";let j,z;const G={components:"messages"};function X(){if(window[`paypal_${H}`].Messages){const e=window[`paypal_${H}`].Messages(j.messageConfig),t=document.getElementById(z);e.render(t)}else $.create("https://www.paypal.com/sdk/js",G,H,j.pageType).then((()=>X()))}const W=function(e,t){if(!e||!t)throw new Error("PaypalElements requires both context and element.");j=e,z=t,G["client-id"]=j.clientId,X()};const Y=l,J="ppcp_paypal_venmo";let Z,K,Q;var ee=function(e,t){if(!e||!t)throw new Error("Venmo button requires both context and element.");Z=e,K=t;const n={"client-id":Z.clientId,intent:Z.intent,components:"buttons",currency:Z.currency,"enable-funding":"venmo"};"sandbox"===Z.environment&&(n["buyer-country"]=Z.buyerCountry),Y.create("https://www.paypal.com/sdk/js",n,J,Z.pageType).then((()=>new Promise((e=>{const t=window[`paypal_${J}`].FUNDING.VENMO,n={createOrder:Z.createOrder,onApprove:Z.onApprove,onClick:Z.onClick,onError:Z.onError,fundingSource:t};Q=window[`paypal_${J}`].Buttons(n),e()})))).then((()=>{const e=document.getElementById(K),t=0===e.childNodes.length;Q.isEligible()&&e&&t&&Q.render(e)})).catch((e=>{console.error("Error initializing Venmo Button:",e)}))};const te=ee;var ne=p({applePayment:function(e,t){return b.create("https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js",{},"",e.pageType),new P(e,t)},cardPayment:k,googlePayment:function(e,t){return O.create("https://pay.google.com/gp/p/js/pay.js",{},"ppcp_pay",e.pageType),new x(e,t)},paypalButtons:function(e,t){return new U(e,t)},paypalMessages:function(e,t){return new W(e,t)},venmoPayment:function(e,t){return new te(e,t)}}),oe=async(e,t,n,o)=>{const a={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};o&&(r.shipping_carrier_code=t,r.shipping_method_code=n);try{return(await window.geneCheckout.services.authenticatedRequest().post(window.geneCheckout.helpers.buildCartUrl("totals-information"),r,{headers:a})).data}catch(e){return console.log(e),null}},ae={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,address:{}}),computed:{...t(e,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await n.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))?(await this.getInitialConfigValues(),await this.renderPaypalInstance()):(t.removeExpressMethod(this.key),this.paypalLoaded=!0)},methods:{...n(e,["getInitialConfigValues"]),async renderPaypalInstance(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),n=this,o={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:t.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:e.currencyCode,isPayLaterEnabled:this.paypal.payLaterActive,isPayLaterMessagingEnabled:this.paypal.payLaterMessageActive,messageStyles:{layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}},buttonStyles:{paypal:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},paylater:{buttonShape:this.paypal.payLaterButtonShape,buttonColor:this.paypal.payLaterButtonColour}},buttonHeight:40},...{createOrder:()=>this.createOrder(n),onApprove:()=>this.onApprove(n),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e),onShippingAddressChange:e=>this.onShippingAddressChange(n,e),onShippingOptionsChange:e=>this.onShippingOptionsChange(n,e)}};ne.paypalButtons(o,"ppcp-express"),this.paypalLoaded=!0},createOrder:async e=>{try{const t=await o(e.method),n=JSON.parse(t),[a]=n;return e.orderID=a,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,n,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!n.validateAgreements()&&(await t.setNotClickAndCollect(),o.setLoadingState(!0),!0)},onShippingAddressChange:async(t,n)=>(t.address=await t.mapAddress(n.shippingAddress),oe(t.address,"","",!1).then((async()=>(async(t,n,o)=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:s}=e(),i=s.changeShippingAddressUrl,c={orderId:t,shippingAddress:n,method:o};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,c,{headers:r})).data}catch(e){return a.setPaymentErrorMessage(e.response.data.message),null}})(t.orderID,JSON.stringify(n.shippingAddress),t.method))).catch((async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async(t,n)=>{const[o,...a]=n.selectedShippingOption.id.split("_");return oe(t.address,o,a.join("_"),!0).then((async()=>(async(t,n,o)=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:s}=e(),i=s.changeShippingMethodUrl,c={orderId:t,shippingMethod:n,method:o};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,c,{headers:r})).data}catch(e){return a.setPaymentErrorMessage(e.response.data.message),null}})(t.orderID,JSON.stringify(n.selectedShippingOption),t.method))).catch((async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async t=>{const[n,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);try{const a=await(async t=>{const n=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),o={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:a}=e(),r=a.finishOrderUrl;try{return(await window.geneCheckout.services.authenticatedRequest().post(r,t,{headers:o})).data}catch(e){return n.setPaymentErrorMessage(e.message),null}})({orderId:t.orderID,method:t.method});null!==a?t.redirectToSuccess():(o.setLoadingState(!1),n.setErrorMessage("Something went wrong. Please check your address."))}catch(e){o.setLoadingState(!1),n.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)},async mapAddress(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};ae.render=function(e,t,n,o,p,d){return c(),a(i,null,[r("div",{id:"ppcp-express-paypal",class:s(["paypal-express--button-container",p.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPal"},null,2),r("div",{id:"ppcp-express-paylater",class:s(["paypal-express--button-container",p.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayLater"},null,2),r("div",{id:"ppcp-express-messages",class:s([p.paypalLoaded?"":"text-loading","paypal-messages-container"]),"data-cy":"instant-checkout-ppcpMessages"},null,2)],64)},ae.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{ae as default};

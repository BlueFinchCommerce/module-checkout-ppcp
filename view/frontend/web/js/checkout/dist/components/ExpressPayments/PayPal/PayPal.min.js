import e from"ppcp-web";import{P as t,m as a,a as s,c as o,h as r,n,b as i,F as p,o as d}from"../../../PpcpStore-B-5sz8Dd.min.js";import{c}from"../../../createPPCPPaymentRest-UEvEk5W3.min.js";var l=async(e,t,a,s)=>{const o={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};s&&(r.shipping_carrier_code=t,r.shipping_method_code=a);try{return(await window.bluefinchCheckout.services.authenticatedRequest().post(window.bluefinchCheckout.helpers.buildCartUrl("totals-information"),r,{headers:o})).data}catch(e){return console.log(e),null}},h={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,paylaterLoaded:!1,paypalEligible:!0,paylaterEligible:!0,address:{}}),computed:{...a(t,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))&&(await this.getInitialConfigValues(),this.paypal.showOnTopCheckout&&this.paypal.enabled?await this.renderPaypalInstance():(t.removeExpressMethod(this.key),this.paypalLoaded=!0,this.paylaterLoaded=!0))},methods:{...s(t,["getInitialConfigValues"]),async renderPaypalInstance(){const[t,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore"]),s=this;let o;this.paypal.payLaterMessageActive&&(o={layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}});const r={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:t.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:a.currencyCode,isPayLaterEnabled:this.paypal.payLaterActive,isPayLaterMessagingEnabled:this.paypal.payLaterMessageActive,messageStyles:o,buttonStyles:{paypal:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},paylater:{buttonShape:this.paypal.payLaterButtonShape,buttonColor:this.paypal.payLaterButtonColour}},buttonHeight:40},...{createOrder:()=>this.createOrder(s),onApprove:()=>this.onApprove(s),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e),onShippingAddressChange:e=>this.onShippingAddressChange(s,e),onShippingOptionsChange:e=>this.onShippingOptionsChange(s,e),isPaymentMethodEligible:(e,t)=>this.isPaymentMethodEligible(e,t)}};e.paypalButtons(r,"ppcp-express")},isPaymentMethodEligible(e,t){this[`${t}Eligible`]=e,this[`${t}Loaded`]=!0},createOrder:async e=>{try{const t=await c(e.method),a=JSON.parse(t),[s]=a;return e.orderID=s,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,a,s]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!a.validateAgreements()&&(await t.setNotClickAndCollect(),s.setLoadingState(!0),!0)},onShippingAddressChange:async(e,a)=>(e.address=await e.mapAddress(a.shippingAddress),l(e.address,"","",!1).then((async()=>(async(e,a,s)=>{const o=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=t(),i=n.changeShippingAddressUrl,p={orderId:e,shippingAddress:a,method:s};try{return(await window.bluefinchCheckout.services.authenticatedRequest().post(i,p,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(e.orderID,JSON.stringify(a.shippingAddress),e.method))).catch((async e=>{const[t,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async(e,a)=>{const[s,...o]=a.selectedShippingOption.id.split("_");return l(e.address,s,o.join("_"),!0).then((async()=>(async(e,a,s)=>{const o=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:n}=t(),i=n.changeShippingMethodUrl,p={orderId:e,shippingMethod:a,method:s};try{return(await window.bluefinchCheckout.services.authenticatedRequest().post(i,p,{headers:r})).data}catch(e){return o.setPaymentErrorMessage(e.response.data.message),null}})(e.orderID,JSON.stringify(a.selectedShippingOption),e.method))).catch((async e=>{const[t,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async e=>{const[a,s]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);try{const o=await(async e=>{const a=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),s={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:o}=t(),r=o.finishOrderUrl;try{return(await window.bluefinchCheckout.services.authenticatedRequest().post(r,e,{headers:s})).data}catch(e){return a.setPaymentErrorMessage(e.message),null}})({orderId:e.orderID,method:e.method});null!==o?e.redirectToSuccess():(s.setLoadingState(!1),a.setErrorMessage("Something went wrong. Please check your address."))}catch(e){s.setLoadingState(!1),a.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,a]=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);a.setLoadingState(!1),t.setErrorMessage(e)},async mapAddress(e){const t=await window.bluefinchCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.bluefinchCheckout.helpers.getSuccessPageUrl()}}};h.render=function(e,t,a,s,c,l){return d(),o(p,null,[e.paypal.showOnTopCheckout&&e.paypal.enabled&&c.paypalEligible?(d(),o("div",{key:0,style:r({order:e.paypal.sortOrder}),id:"ppcp-express-paypal",class:n(["paypal-express--button-container",c.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPal"},null,6)):i("v-if",!0),e.paypal.showOnTopCheckout&&e.paypal.payLaterActive&&c.paylaterEligible?(d(),o("div",{key:1,style:r({order:e.paypal.sortOrder}),id:"ppcp-express-paylater",class:n(["paypal-express--button-container",[c.paylaterLoaded?"":"text-loading",e.paypal.payLaterMessageActive?"message-active":""]]),"data-cy":"instant-checkout-ppcpPayLater"},null,6)):i("v-if",!0)],64)},h.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{h as default};

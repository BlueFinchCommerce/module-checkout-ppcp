import{P as e,m as t,a as n,g as o,c as a,i as r,n as s,F as i,o as c}from"../../../createPPCPPaymentRest-bZhSKs1h.min.js";function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const d={};var l={create:function(e,t,n="ppcp",o,a){t&&((e=new URL(e)).search=new URLSearchParams(t),e=decodeURIComponent(e.href));const r=((e,t,n="")=>e+t+n)(e,n,a);return d[r]||(d[r]=new Promise((t=>{const r=document.createElement("script");r.src=e,r.dataset.namespace=`paypal_${n}`,r.dataset.partnerAttributionId="GENE_PPCP",r.dataset.pageType=o||"checkout",a&&(r.dataset.userIdToken=a),r.onload=()=>{console.log("script loaded: ",r.src);const e=new CustomEvent("ppcpScriptLoaded",{detail:n});document.dispatchEvent(e),t()},document.head.appendChild(r)}))),d[r]}};const u=l,h="ppcp_applepay_new";let y,g,m;var w=function(e,t){if(!e||!t)throw new Error("Apple Pay requires both context and element.");y=e,g=t;const n={"client-id":y.clientId,intent:y.intent,components:"applepay",currency:y.currency};"sandbox"===y.environment&&(n["buyer-country"]=y.buyerCountry),u.create("https://www.paypal.com/sdk/js",n,h,y.pageType).then((()=>new Promise(((e,t)=>"https:"!==location.protocol?(console.warn("PPCP Apple Pay requires your checkout be served over HTTPS"),!1):!0!==(window.ApplePaySession&&window.ApplePaySession.canMakePayments())?(console.warn("PPCP Apple Pay is not supported on this device/browser"),!1):(window[`paypal_${h}`].Applepay().config().then((n=>{n.isEligible?(m=y.getPaymentRequest(n),e()):(console.warn("PPCP Apple Pay is not eligible"),t())})).catch((()=>{console.error("Error while fetching Apple Pay configuration."),t()})),!0))))).then((()=>new Promise(((e,t)=>{const n=document.createElement("apple-pay-button");n.onclick=function(){!function(){const e=new window.ApplePaySession(4,m),t=window[`paypal_${h}`].Applepay();e.onvalidatemerchant=n=>{t.validateMerchant({validationUrl:n.validationURL}).then((t=>{e.completeMerchantValidation(t.merchantSession)})).catch((t=>{console.error(t),e.abort(),loader.stopLoader()}))},e.onshippingcontactselected=function(t){return y.onShippingContactSelect(t,e)},e.onshippingmethodselected=function(t){return y.onShippingMethodSelect(t,e)},e.onpaymentauthorized=function(n){return y.onPaymentAuthorized(n,e,t)},e.begin()}()},document.getElementById(g).appendChild(n),e()}))))};const C=w,P=l;const b=l,f="ppcp_card_new";let S;var E=function(e,t){if(!e||!t)throw new Error("Card Payments requires both context and element.");S=e;const n={"client-id":S.clientId,intent:S.intent,components:"card-fields",currency:S.currency};b.create("https://www.paypal.com/sdk/js",n,f,S.pageType).then((()=>function(){if(window[`paypal_${f}`]){!function(e){const t=S.cardFields.numberField,n=S.cardFields.cvvField,o=S.cardFields.expiryField;if(e.isEligible()){const a=document.querySelector(t.id),r=document.querySelector(n.id),s=document.querySelector(o.id),i=e.NumberField({placeholder:t.placeholder,inputEvents:{onBlur:e=>t.inputEvents.blur(e,a),onFocus:()=>{}}}),c=e.CVVField({placeholder:n.placeholder,inputEvents:{onBlur:e=>n.inputEvents.blur(e,r),onFocus:()=>{}}}),p=e.ExpiryField({placeholder:o.placeholder,inputEvents:{onBlur:e=>o.inputEvents.blur(e,s),onFocus:()=>{}}});""===a.innerHTML.trim()&&i.render(t.id),""===r.innerHTML.trim()&&c.render(n.id),""===s.innerHTML.trim()&&p.render(o.id),document.querySelector(S.submitButtonId).addEventListener("click",(()=>{S.runAdditionalValidators()&&e.getState().then((t=>{if(t.isFormValid)e.submit().then((()=>{})).catch((e=>{console.error(e),S.displayErrorMessage("Cannot validate payment.")}));else{let e="";t.errors.includes("INVALID_NUMBER")&&(e+="Card number is not valid."),t.errors.includes("INVALID_EXPIRY")&&(e+=" Expiry date is not valid."),t.errors.includes("INVALID_CVV")&&(e+=" CVV is not valid."),S.displayErrorMessage(e)}}))}))}}(window[`paypal_${f}`].CardFields({createOrder:()=>S.createOrder(),onApprove:()=>S.onApprove(),onError:()=>S.onError(),style:S.style}))}else S.active(!1)}()))};const v=l;let k,I;function L(e){if(k.validateAdditionalValidators&&!k.validateAdditionalValidators())return!1;const t={...e},n=["PAYMENT_AUTHORIZATION"],o=k.onPaymentDataChanged;return o&&n.push("SHIPPING_ADDRESS","SHIPPING_OPTION"),t.allowedPaymentMethods=e.allowedPaymentMethods,t.transactionInfo={countryCode:e.countryCode,currencyCode:k.transactionInfo.currencyCode,totalPriceStatus:k.transactionInfo.totalPriceStatus,totalPrice:parseFloat(k.transactionInfo.totalPrice).toFixed(2)},t.merchantInfo=e.merchantInfo,t.shippingAddressRequired=!!o,t.shippingAddressParameters={phoneNumberRequired:!!o},t.emailRequired=!0,t.shippingOptionRequired=!!o,t.callbackIntents=n,delete t.countryCode,delete t.isEligible,I.loadPaymentData(t).catch((e=>{console.warn(e)}))}function A(){return"sandbox"===k.environment?"TEST":"PRODUCTION"}var M=function(e,t){if(!e||!t)throw new Error("Google Payments requires both context and element.");if("function"!=typeof e.placeOrder)return console.error("PPCP Google Pay Context passed does not provide a placeOrder method",e);k=e;const n={"client-id":k.clientId,intent:k.intent,components:"googlepay",currency:k.transactionInfo.currencyCode};"sandbox"===k.environment&&(n["buyer-country"]=k.buyerCountry),v.create("https://www.paypal.com/sdk/js",n,"ppcp_googlepay",k.pageType).then((()=>new Promise(((e,t)=>{if("https:"!==location.protocol)return console.warn("Google Pay requires your checkout be served over HTTPS"),!1;window.paypal_ppcp_googlepay.Googlepay().config().then((n=>{n.isEligible?(n.allowedPaymentMethods.forEach((e=>{e.parameters.billingAddressParameters.phoneNumberRequired=!0})),e(n)):t()}))})))).then((e=>function(e){const t={onPaymentAuthorized:t=>k.onPaymentAuthorized(t,e)};k.onPaymentDataChanged&&(t.onPaymentDataChanged=t=>k.onPaymentDataChanged(t,e));return I=new window.google.payments.api.PaymentsClient({environment:A(),paymentDataCallbacks:t}),I.isReadyToPay({apiVersion:e.apiVersion,apiVersionMinor:e.apiVersionMinor,allowedPaymentMethods:e.allowedPaymentMethods}).then((t=>{if(t.result)return e}))}(e))).then((e=>function(e){return I.createButton({allowedPaymentMethods:e.allowedPaymentMethods,buttonColor:k.button.buttonColor.toLowerCase(),buttonSizeMode:"fill",onClick:k.beforeOnClick?()=>k.beforeOnClick().then((()=>L(e))):()=>L(e)})}(e))).then((e=>{if(e){document.getElementById(t).appendChild(e)}})).catch((e=>{console.error("Error initializing Google Pay Button:",e)}))};const _=M,x=l;const O=l,T="ppcp_paypal_new";let F,R,q;const N={};var B=function(e,t){if(!e||!t)throw new Error("PaypalButtons requires both context and element.");F=e,R=t;const n={"client-id":F.productionClientId,intent:F.intent,components:"buttons",currency:F.currency};"sandbox"===F.environment&&(n["client-id"]=F.sandboxClientId,n["buyer-country"]=F.buyerCountry),F.isPayLaterMessagingEnabled&&(n.components+=",messages"),F.isPayLaterEnabled&&(n["enable-funding"]="paylater"),O.create("https://www.paypal.com/sdk/js",n,T,F.pageType).then((()=>new Promise(((e,t)=>{const n=[window[`paypal_${T}`].FUNDING.PAYPAL];F.isPayLaterEnabled&&n.push(window[`paypal_${T}`].FUNDING.PAYLATER),q=n.filter((e=>{const t=`${R}-${e}`;if(document.getElementById(t))return document.getElementById(t);console.error("Paypal button element does not exist",t)})),e()})))).then((()=>new Promise(((e,t)=>{q.forEach((e=>{const t={createOrder:()=>F.createOrder(),onApprove:F.onApprove,onClick:F.onClick,onCancel:F.onCancel,onError:e=>F.onError(e),onShippingAddressChange:e=>F.onShippingAddressChange(e),onShippingOptionsChange:e=>F.onShippingOptionsChange(e)};t.fundingSource=e,t.style=function(e){const{[e]:{buttonColor:t,buttonLabel:n,buttonShape:o}}=F.buttonStyles||{};return{color:t,label:n,shape:o,height:F.buttonHeight?F.buttonHeight:40}}(e),t.message=function(e){if(console.log(F.messageStyles),"paylater"===e&&F.isPayLaterMessagingEnabled&&"checkout"===F.pageType){const e=F.messageStyles.text||{};return{align:e.align,amount:F.amount,color:"black"!==e.color||"white"!==e.color?"black":e.color}}}(e),N[e]=window[`paypal_${T}`].Buttons(t)})),e()})))).then((()=>{Object.keys(N).forEach((e=>{const t=document.getElementById(`${R}-${e}`),n=0===t.childNodes.length;N[e].isEligible()&&t&&n&&N[e].render(t)}))})).catch((e=>{console.error("Error initializing PayPal Buttons:",e)}))};const V=B;const D=l,U="ppcp_paypal_messages";let $,H,j={components:"messages"};function z(){if(window[`paypal_${U}`]?.Messages){const e=window[`paypal_${U}`].Messages($.messageConfig),t=document.getElementById(H);e.render(t)}else D.create("https://www.paypal.com/sdk/js",j,U,$.pageType).then((()=>z()))}const G=function(e,t){if(!e||!t)throw new Error("PaypalElements requires both context and element.");$=e,H=t,j["client-id"]=$.clientId,z()};const X=l,W="ppcp_paypal_venmo";let Y,J,Z;var K=function(e,t){if(!e||!t)throw new Error("Venmo button requires both context and element.");Y=e,J=t;const n={"client-id":Y.clientId,intent:Y.intent,components:"buttons",currency:Y.currency,"enable-funding":"venmo"};"sandbox"===Y.environment&&(n["buyer-country"]=Y.buyerCountry),X.create("https://www.paypal.com/sdk/js",n,W,Y.pageType).then((()=>new Promise((e=>{const t=window[`paypal_${W}`].FUNDING.VENMO,n={createOrder:Y.createOrder,onApprove:Y.onApprove,onClick:Y.onClick,onError:Y.onError,fundingSource:t};Z=window[`paypal_${W}`].Buttons(n),e()})))).then((()=>{const e=document.getElementById(J),t=0===e.childNodes.length;Z.isEligible()&&e&&t&&Z.render(e)})).catch((e=>{console.error("Error initializing Venmo Button:",e)}))};const Q=K;var ee=p({applePayment:function(e,t){return P.create("https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js",{},"",e.pageType),new C(e,t)},cardPayment:E,googlePayment:function(e,t){return x.create("https://pay.google.com/gp/p/js/pay.js",{},"ppcp_pay",e.pageType),new _(e,t)},paypalButtons:function(e,t){return new V(e,t)},paypalMessages:function(e,t){return new G(e,t)},venmoPayment:function(e,t){return new Q(e,t)}}),te=async(e,t,n,o)=>{const a={"X-Requested-With":"XMLHttpRequest"},r={addressInformation:{address:e}};o&&(r.shipping_carrier_code=t,r.shipping_method_code=n);try{return(await window.geneCheckout.services.authenticatedRequest().post(window.geneCheckout.helpers.buildCartUrl("totals-information"),r,{headers:a})).data}catch(e){return console.log(e),null}},ne={name:"PpcpPayPal",data:()=>({key:"ppcpPayPal",method:"ppcp_paypal",namespace:"paypal_ppcp_paypal",orderID:null,paypalLoaded:!1,address:{}}),computed:{...t(e,["paypal","environment","buyerCountry","productionClientId","sandboxClientId"])},async created(){const[e,t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await n.getInitialConfig(),await e.getCart();t.availableMethods.find((e=>e.code===this.method))?(await this.getInitialConfigValues(),await this.renderPaypalInstance()):(t.removeExpressMethod(this.key),this.paypalLoaded=!0)},methods:{...n(e,["getInitialConfigValues"]),async renderPaypalInstance(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]),n=this,o={...{sandboxClientId:this.sandboxClientId,productionClientId:this.productionClientId,intent:this.paypal.paymentAction,pageType:"checkout",environment:this.environment,commit:!0,amount:t.cart.prices.grand_total.value,buyerCountry:this.buyerCountry,currency:e.currencyCode,isPayLaterEnabled:this.paypal.payLaterActive,isPayLaterMessagingEnabled:this.paypal.payLaterMessageActive,messageStyles:{layout:this.paypal.payLaterMessageLayout,logo:{type:this.paypal.payLaterMessageLogoType,position:this.paypal.payLaterMessageLogoPosition},text:{size:this.paypal.payLaterMessageTextSize,color:this.paypal.payLaterMessageColour,align:this.paypal.payLaterMessageTextAlign}},buttonStyles:{paypal:{buttonLabel:this.paypal.buttonLabel,buttonSize:"responsive",buttonShape:this.paypal.buttonShape,buttonColor:this.paypal.buttonColor,buttonTagline:!1},paylater:{buttonShape:this.paypal.payLaterButtonShape,buttonColor:this.paypal.payLaterButtonColour}},buttonHeight:40},...{createOrder:()=>this.createOrder(n),onApprove:()=>this.onApprove(n),onClick:()=>this.onClick(),onCancel:()=>this.onCancel(),onError:e=>this.onError(e),onShippingAddressChange:e=>this.onShippingAddressChange(n,e),onShippingOptionsChange:e=>this.onShippingOptionsChange(n,e)}};ee.paypalButtons(o,"ppcp-express")},createOrder:async e=>{try{const t=await o(e.method),n=JSON.parse(t),[a]=n;return e.orderID=a,e.orderID}catch(e){return console.error("Error during createOrder:",e),null}},onClick:async()=>{const[e,t,n,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useShippingMethodsStore","stores.useAgreementStore","stores.useLoadingStore"]);e.setErrorMessage("");return!!n.validateAgreements()&&(await t.setNotClickAndCollect(),o.setLoadingState(!0),!0)},onShippingAddressChange:async(t,n)=>(t.address=await t.mapAddress(n.shippingAddress),te(t.address,"","",!1).then((async()=>(async(t,n,o)=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:s}=e(),i=s.changeShippingAddressUrl,c={orderId:t,shippingAddress:n,method:o};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,c,{headers:r})).data}catch(e){return a.setPaymentErrorMessage(e.response.data.message),null}})(t.orderID,JSON.stringify(n.shippingAddress),t.method))).catch((async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)}))),onShippingOptionsChange:async(t,n)=>{const[o,...a]=n.selectedShippingOption.id.split("_");return te(t.address,o,a.join("_"),!0).then((async()=>(async(t,n,o)=>{const a=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),r={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:s}=e(),i=s.changeShippingMethodUrl,c={orderId:t,shippingMethod:n,method:o};try{return(await window.geneCheckout.services.authenticatedRequest().post(i,c,{headers:r})).data}catch(e){return a.setPaymentErrorMessage(e.response.data.message),null}})(t.orderID,JSON.stringify(n.selectedShippingOption),t.method))).catch((async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)}))},onApprove:async t=>{const[n,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);try{const a=await(async t=>{const n=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore"]),o={"X-Requested-With":"XMLHttpRequest"},{ppcpConfig:a}=e(),r=a.finishOrderUrl;try{return(await window.geneCheckout.services.authenticatedRequest().post(r,t,{headers:o})).data}catch(e){return n.setPaymentErrorMessage(e.message),null}})({orderId:t.orderID,method:t.method});null!==a?t.redirectToSuccess():(o.setLoadingState(!1),n.setErrorMessage("Something went wrong. Please check your address."))}catch(e){o.setLoadingState(!1),n.setErrorMessage(e)}},onCancel:async()=>{const[e,t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore","stores.useLoadingStore"]);t.setLoadingState(!1),e.createNewAddress("shipping")},onError:async e=>{const[t,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useLoadingStore"]);n.setLoadingState(!1),t.setErrorMessage(e)},async mapAddress(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]);return{city:e.city,country_id:e.countryCode,postcode:e.postalCode,region:void 0!==e.state?e.state:"",region_id:t.getRegionId(e.countryCode,e.state)}},redirectToSuccess(){window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()}}};ne.render=function(e,t,n,o,p,d){return c(),a(i,null,[r("div",{id:"ppcp-express-paypal",class:s(["paypal-express--button-container",p.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayPal"},null,2),r("div",{id:"ppcp-express-paylater",class:s(["paypal-express--button-container",p.paypalLoaded?"":"text-loading"]),"data-cy":"instant-checkout-ppcpPayLater"},null,2),r("div",{id:"ppcp-express-messages",class:s([p.paypalLoaded?"":"text-loading","paypal-messages-container"]),"data-cy":"instant-checkout-ppcpMessages"},null,2)],64)},ne.__file="src/components/ExpressPayments/PayPal/PayPal.vue";export{ne as default};

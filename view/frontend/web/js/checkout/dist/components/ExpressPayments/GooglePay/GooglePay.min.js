import{h as e,i as t,r as a,w as n,a as o,m as p,e as r,b as s,d as i,t as c,n as l,g as _,f as d,j as u,k as y,c as h,l as g,o as m}from"../../../runtime-core.esm-bundler-BkTYBQhz.min.js";
/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let v;const P=e=>v=e,b=Symbol();function f(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var C;!function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"}(C||(C={}));const A="undefined"!=typeof window,S="undefined"!=typeof __VUE_PROD_DEVTOOLS__&&__VUE_PROD_DEVTOOLS__&&A,w=()=>{};function I(e,t,a,n=w){e.push(t);const o=()=>{const a=e.indexOf(t);a>-1&&(e.splice(a,1),n())};return!a&&_()&&d(o),o}function O(e,...t){e.slice().forEach((e=>{e(...t)}))}const M=e=>e();function L(e,t){e instanceof Map&&t instanceof Map&&t.forEach(((t,a)=>e.set(a,t))),e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const a in t){if(!t.hasOwnProperty(a))continue;const n=t[a],o=e[a];f(o)&&f(n)&&e.hasOwnProperty(a)&&!s(n)&&!i(n)?e[a]=L(o,n):e[a]=n}return e}const N=Symbol();const{assign:k}=Object;function D(e,t,_={},d,u,y){let h;const g=k({actions:{}},_),m={deep:!0};let v,b,A,D=[],E=[];const T=d.state.value[e];y||T||(d.state.value[e]={});const x=a({});let $;function j(t){let a;v=b=!1,"function"==typeof t?(t(d.state.value[e]),a={type:C.patchFunction,storeId:e,events:A}):(L(d.state.value[e],t),a={type:C.patchObject,payload:t,storeId:e,events:A});const n=$=Symbol();l().then((()=>{$===n&&(v=!0)})),b=!0,O(D,a,d.state.value[e])}const R=y?function(){const{state:e}=_,t=e?e():{};this.$patch((e=>{k(e,t)}))}:w;function V(t,a){return function(){P(d);const n=Array.from(arguments),o=[],p=[];let r;O(E,{args:n,name:t,store:q,after:function(e){o.push(e)},onError:function(e){p.push(e)}});try{r=a.apply(this&&this.$id===e?this:q,n)}catch(e){throw O(p,e),e}return r instanceof Promise?r.then((e=>(O(o,e),e))).catch((e=>(O(p,e),Promise.reject(e)))):(O(o,r),r)}}const G=p({actions:{},getters:{},state:[],hotState:x}),U={_p:d,$id:e,$onAction:I.bind(null,E),$patch:j,$reset:R,$subscribe(t,a={}){const o=I(D,t,a.detached,(()=>p())),p=h.run((()=>n((()=>d.state.value[e]),(n=>{("sync"===a.flush?b:v)&&t({storeId:e,type:C.direct,events:A},n)}),k({},m,a))));return o},$dispose:function(){h.stop(),D=[],E=[],d._s.delete(e)}},q=o(S?k({_hmrPayload:G,_customProperties:p(new Set)},U):U);d._s.set(e,q);const F=(d._a&&d._a.runWithContext||M)((()=>d._e.run((()=>(h=r()).run(t)))));for(const t in F){const a=F[t];if(s(a)&&(!s(z=a)||!z.effect)||i(a))y||(!T||f(H=a)&&H.hasOwnProperty(N)||(s(a)?a.value=T[t]:L(a,T[t])),d.state.value[e][t]=a);else if("function"==typeof a){const e=V(t,a);F[t]=e,g.actions[t]=a}}var H,z;if(k(q,F),k(c(q),F),Object.defineProperty(q,"$state",{get:()=>d.state.value[e],set:e=>{j((t=>{k(t,e)}))}}),S){const e={writable:!0,configurable:!0,enumerable:!1};["_p","_hmrPayload","_getters","_customProperties"].forEach((t=>{Object.defineProperty(q,t,k({value:q[t]},e))}))}return d._p.forEach((e=>{if(S){const t=h.run((()=>e({store:q,app:d._a,pinia:d,options:g})));Object.keys(t||{}).forEach((e=>q._customProperties.add(e))),k(q,t)}else k(q,h.run((()=>e({store:q,app:d._a,pinia:d,options:g}))))})),T&&y&&_.hydrate&&_.hydrate(q.$state,T),v=!0,b=!0,q}var E,T,x=function(a,n,o){let r,s;const i="function"==typeof n;function c(a,o){const c=e();(a=a||(c?t(b,null):null))&&P(a),(a=v)._s.has(r)||(i?D(r,n,s,a):function(e,t,a){const{state:n,actions:o,getters:r}=t,s=a.state.value[e];let i;i=D(e,(function(){s||(a.state.value[e]=n?n():{});const t=u(a.state.value[e]);return k(t,o,Object.keys(r||{}).reduce(((t,n)=>(t[n]=p(y((()=>{P(a);const t=a._s.get(e);return r[n].call(t,t)}))),t)),{}))}),t,a,0,!0)}(r,s,a));return a._s.get(r)}return"string"==typeof a?(r=a,s=i?o:n):(s=a,r=a.id),c.$id=r,c}("ppcpStore",{state:()=>({cache:{},environment:"sandbox",isPPCPenabled:!1,sandboxClientId:"",productionClientId:"",buyerCountry:"",errorMessage:null,apple:{merchantName:"",enabled:!1,paymentAction:"",sortOrder:null,title:""},venmo:{vaultActive:!1,enabled:!1,paymentAction:"",sortOrder:null,title:""},apm:{enabled:!1,title:"",sortOrder:null,allowedPayments:[]},google:{buttonColor:"white",enabled:!1,paymentAction:"",sortOrder:null,title:""},paypal:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",requireBillingAddress:!1,sortOrder:null,buttonLabel:"",buttonColor:"gold",buttonShape:"",payLaterActive:!1,payLaterButtonColour:"black",payLaterButtonShape:"",payLaterMessageActive:!1,payLaterMessageLayout:"",payLaterMessageLogoType:"",payLaterMessageLogoPosition:"",payLaterMessageColour:"",payLaterMessageTextSize:"",payLaterMessageTextAlign:""},card:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",threeDSecureStatus:"",sortOrder:null}}),getters:{selectedVaultMethod:e=>[]},actions:{setData(e){this.$patch(e)},getInitialConfigValues:()=>"\n        storeConfig {\n          ppcp_environment\n          ppcp_active\n          ppcp_sandbox_client_id\n          ppcp_client_id_production\n          ppcp_buyer_country\n          \n          ppcp_googlepay_active\n          ppcp_googlepay_title\n          ppcp_googlepay_payment_action\n          ppcp_googlepay_button_colour\n          ppcp_googlepay_sort_order\n          \n          ppcp_applepay_active\n          ppcp_applepay_title\n          ppcp_applepay_payment_action\n          ppcp_applepay_merchant_name\n          ppcp_applepay_sort_order\n    \n          ppcp_paypal_active\n          ppcp_paypal_vault_active\n          ppcp_paypal_title\n          ppcp_paypal_payment_action\n          ppcp_paypal_require_billing_address\n          ppcp_paypal_sort_order\n          ppcp_paypal_button_paypal_label\n          ppcp_paypal_button_paypal_color\n          ppcp_paypal_button_paypal_shape\n          ppcp_paypal_paylater_enable_paylater\n          ppcp_paypal_paylater_button_paylater_color\n          ppcp_paypal_paylater_button_paylater_shape\n          ppcp_paypal_paylater_message_enable\n          ppcp_paypal_paylater_message_layout\n          ppcp_paypal_paylater_message_logo_type\n          ppcp_paypal_paylater_message_logo_position\n          ppcp_paypal_paylater_message_text_color\n          ppcp_paypal_paylater_message_text_size\n          ppcp_paypal_paylater_message_text_align\n    \n          ppcp_venmo_active\n          ppcp_venmo_title\n          ppcp_venmo_payment_action\n          ppcp_venmo_vault_active\n          ppcp_venmo_sort_order\n          \n          ppcp_apm_active\n          ppcp_apm_title\n          ppcp_apm_allowed_methods\n          ppcp_apm_sort_order\n          \n          ppcp_card_active\n          ppcp_card_vault_active\n          ppcp_card_title\n          ppcp_card_payment_action\n          ppcp_card_three_d_secure\n          ppcp_card_sort_order\n        }\n      ",handleInitialConfig({storeConfig:e}){e&&this.setData({environment:e.ppcp_environment,isPPCPenabled:e.ppcp_active,sandboxClientId:e.ppcp_sandbox_client_id,productionClientId:e.ppcp_client_id_production,buyerCountry:e.ppcp_buyer_country,card:{enabled:e.ppcp_card_active,vaultActive:e.ppcp_card_vault_active,title:e.ppcp_card_title,paymentAction:e.ppcp_card_payment_action,threeDSecureStatus:e.ppcp_card_three_d_secure,sortOrder:e.ppcp_card_sort_order},google:{buttonColor:e.ppcp_googlepay_button_colour,enabled:e.ppcp_googlepay_active,paymentAction:e.ppcp_googlepay_payment_action,sortOrder:e.ppcp_googlepay_sort_order,title:e.ppcp_googlepay_title},apple:{merchantName:e.ppcp_applepay_merchant_name,enabled:e.ppcp_applepay_active,paymentAction:e.ppcp_applepay_payment_action,sortOrder:e.ppcp_applepay_sort_order,title:e.ppcp_applepay_title},venmo:{vaultActive:e.ppcp_venmo_payment_action,enabled:e.ppcp_venmo_active,paymentAction:e.ppcp_venmo_payment_action,sortOrder:e.ppcp_venmo_sort_order,title:e.ppcp_venmo_title},apm:{enabled:e.ppcp_apm_active,title:e.ppcp_apm_title,sortOrder:e.ppcp_apm_allowed_methods,allowedPayments:e.ppcp_apm_sort_order},paypal:{enabled:e.ppcp_paypal_active,vaultActive:e.ppcp_paypal_vault_active,title:e.ppcp_paypal_title,paymentAction:e.ppcp_paypal_payment_action,requireBillingAddress:e.ppcp_paypal_require_billing_address,sortOrder:e.ppcp_paypal_sort_order,buttonLabel:e.ppcp_paypal_button_paypal_label,buttonColor:e.ppcp_paypal_button_paypal_color,buttonShape:e.ppcp_paypal_button_paypal_shape,payLaterActive:e.ppcp_paypal_paylater_enable_paylater,payLaterButtonColour:e.ppcp_paypal_paylater_button_paylater_color,payLaterButtonShape:e.ppcp_paypal_paylater_button_paylater_shape,payLaterMessageActive:e.ppcp_paypal_paylater_message_enable,payLaterMessageLayout:e.ppcp_paypal_paylater_message_layout,payLaterMessageLogoType:e.ppcp_paypal_paylater_message_logo_type,payLaterMessageLogoPosition:e.ppcp_paypal_paylater_message_logo_position,payLaterMessageColour:e.ppcp_paypal_paylater_message_text_color,payLaterMessageTextSize:e.ppcp_paypal_paylater_message_text_size,payLaterMessageTextAlign:e.ppcp_paypal_paylater_message_text_align}})},async createClientToken(){},setClientInstance(e){this.setData({clientInstance:e})},setThreeDSInstance(e){this.setData({threeDSecureInstance:e})},setErrorMessage(e){this.setData({errorMessage:e})},clearErrorMessage(){this.setData({errorMessage:null})},escapeNonAsciiCharacters:e=>e.split("").map((e=>/[^\x00-\x7F]$/.test(e)?e:e.split("").map((e=>`\\u00${e.charCodeAt().toString(16)}`)).join(""))).join(""),async getVaultedMethods(){},selectVaultedMethod(e){this.unselectVaultedMethods(),this.setData({vaultedMethods:{[e.publicHash]:{selected:!0}}})},mapCartTypes(e){switch(e){case"AE":return"american-express";case"DI":return"discover";case"DN":return"diners-club";case"JCB":return"jcb";case"MC":return"master-card";case"MI":return"maestro";case"UPD":return"unionpay";case"VI":return"visa";default:return""}},unselectVaultedMethods(){Object.keys(this.vaultedMethods).forEach((e=>{this.setData({vaultedMethods:{[e]:{selected:!1}}})}))},getCachedResponse(e,t,a={}){if(void 0!==this.$state.cache[t])return this.$state.cache[t];const n=e(a);return this.$patch({cache:{[t]:n}}),n},clearCache(e){e&&this.setData({cache:{[e]:void 0}})}}}),$={name:"PpcpGooglePay",data:()=>({googlePayNoShippingMethods:"",instance:null,googleClient:null,googlePaymentInstance:null,googlePayLoaded:!1,key:"ppcpGooglePay",method:"ppcp_googlepay"}),computed:{...(E=x,T=[],Array.isArray(T)?T.reduce(((e,t)=>(e[t]=function(){return E(this.$pinia)[t]},e)),{}):Object.keys(T).reduce(((e,t)=>(e[t]=function(){const e=E(this.$pinia),a=T[t];return"function"==typeof a?a.call(this,e):e[a]},e)),{}))},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart();const n=t.availableMethods.find((e=>e.code===this.method));if(!n)return t.removeExpressMethod(this.key),void(this.googlePayLoaded=!0);await this.createClientToken(),this.googleClient=p(new window.google.payments.api.PaymentsClient({environment:"sandbox"===this.environment?"TEST":"PRODUCTION",paymentDataCallbacks:{...e.cart.is_virtual?{}:{onPaymentDataChanged:this.onPaymentDataChanged},onPaymentAuthorized:this.onPaymentAuthorized}})),this.instance=await p(braintree.client.create({authorization:this.clientToken})),braintree.googlePayment.create({client:this.instance,googlePayVersion:2},((e,t)=>{this.googlePaymentInstance=p(t),this.googleClient.isReadyToPay({apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:t.createPaymentDataRequest().allowedPaymentMethods,existingPaymentMethodRequired:!0}).then((async e=>{if(e){const e=this.googleClient.createButton({buttonColor:this.google.buttonColor,buttonType:"buy",buttonSizeMode:"fill",onClick:()=>this.onClick(n.code)});this.$refs.braintreeGooglePay.append(e),this.googlePayLoaded=!0}}))}))},mounted(){const e=document.createElement("script");e.setAttribute("src","https://pay.google.com/gp/p/js/pay.js"),document.head.appendChild(e)},methods:{...function(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]=function(...t){return e(this.$pinia)[a](...t)},t)),{}):Object.keys(t).reduce(((a,n)=>(a[n]=function(...a){return e(this.$pinia)[t[n]](...a)},a)),{})}(x,["createClientToken"]),async onClick(e){const[t,a,n,o,p,r,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useCustomerStore","stores.useShippingMethodsStore","stores.usePaymentStore"]);s.setErrorMessage("");if(!t.validateAgreements())return!1;r.setNotClickAndCollect();const i=["PAYMENT_AUTHORIZATION"];a.cart.is_virtual||i.push("SHIPPING_ADDRESS","SHIPPING_OPTION");const c={transactionInfo:{countryCode:n.countryCode,currencyCode:n.currencyCode,totalPriceStatus:"FINAL",totalPrice:(a.cartGrandTotal/100).toString()},emailRequired:!0,shippingAddressRequired:!a.cart.is_virtual,shippingAddressParameters:{phoneNumberRequired:!a.cart.is_virtual},shippingOptionRequired:!a.cart.is_virtual,callbackIntents:i};"sandbox"!==this.environment&&(c.merchantInfo={merchantId:this.google.merchantId});const l=this.googlePaymentInstance.createPaymentDataRequest(c),_=l.allowedPaymentMethods[0];return _.parameters.billingAddressRequired=!0,_.parameters.billingAddressParameters={format:"FULL",phoneNumberRequired:!0},window.geneCheckout.helpers.expressPaymentOnClickDataLayer(e),o.setLoadingState(!0),this.googleClient.loadPaymentData(l).then(this.makePayment).then((()=>window.geneCheckout.services.refreshCustomerData(["cart"]))).then((()=>{window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()})).catch((e=>{o.setLoadingState(!1);try{window.geneCheckout.helpers.handleServiceError(e)}catch(e){p.createNewAddress("shipping"),s.setErrorMessage(e)}}))},getGooglePayMethod:e=>e.paymentMethods.find((({type:e})=>"paywithgoogle"===e||"googlepay")),async onPaymentDataChanged(e){const[t,a,n,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useShippingMethodsStore"]);return new Promise((p=>{const r={city:e.shippingAddress.locality,company:"",country_code:e.shippingAddress.countryCode,postcode:e.shippingAddress.postalCode,region:e.shippingAddress.administrativeArea,region_id:a.getRegionId(e.shippingAddress.countryCode,e.shippingAddress.administrativeArea),street:["0"],telephone:"000000000",firstname:"UNKNOWN",lastname:"UNKNOWN"};window.geneCheckout.services.getShippingMethods(r,this.method,!0).then((async r=>{const s=r.shipping_addresses[0].available_shipping_methods,i=s.map((e=>{const t=e.carrier_title?`${window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value)} ${e.carrier_title}`:window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value);return{id:e.method_code,label:e.method_title,description:t}})).filter((e=>"nominated_delivery"!==e.id));if(!i.length)return void p({error:{reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:this.$t("errorMessages.googlePayNoShippingMethods"),intent:"SHIPPING_ADDRESS"}});const c="shipping_option_unselected"===e.shippingOptionData.id?s[0]:s.find((({method_code:t})=>t===e.shippingOptionData.id))||s[0];await o.submitShippingInfo(c.carrier_code,c.method_code),n.setLoadingState(!0);const l={newShippingOptionParameters:{defaultSelectedOptionId:c.method_code,shippingOptions:i},newTransactionInfo:{displayItems:[{label:"Shipping",type:"LINE_ITEM",price:t.cart.shipping_addresses[0].selected_shipping_method.amount.value.toString(),status:"FINAL"}],currencyCode:t.cart.prices.grand_total.currency,totalPriceStatus:"FINAL",totalPrice:t.cart.prices.grand_total.value.toString(),totalPriceLabel:"Total",countryCode:a.countryCode}};p(l)}))}))},async onPaymentAuthorized(e){const[t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]);return new Promise((a=>{if(!t.cart.is_virtual&&!t.cart.shipping_addresses[0].selected_shipping_method)return void a({error:{reason:"SHIPPING_OPTION_INVALID",message:"No shipping method selected",intent:"SHIPPING_OPTION"}});const{androidPayCards:n}=JSON.parse(e.paymentMethodData.tokenizationData.token);if(!n?.[0]?.nonce||!n?.[0]?.details?.bin)return void a({error:{reason:"SHIPPING_OPTION_INVALID",message:"Unable to validate payment. Please try again with another payment method.",intent:"SHIPPING_OPTION"}});const{email:o}=e,{billingAddress:p}=e.paymentMethodData.info,{phoneNumber:r}=p,s=this.mapAddress(p,o,r);let i=null;if(!t.cart.is_virtual){const{shippingAddress:t}=e,{phoneNumber:a}=t;i=this.mapAddress(t,o,a)}try{window.geneCheckout.services.setAddressesOnCart(i,s,o).then((()=>{a({transactionState:"SUCCESS"})}))}catch(e){a({error:{reason:"PAYMENT_DATA_INVALID",message:e.message,intent:"PAYMENT_AUTHORIZATION"}})}}))},makePayment(e){const t={email:e.email,paymentMethod:{method:this.method,additional_data:{payment_method_nonce:e.nonce},extension_attributes:window.geneCheckout.helpers.getPaymentExtensionAttributes()}};return window.geneCheckout.services.createPayment(t)},async mapAddress(e,t,a){const[n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),[o,...p]=e.name.split(" "),r=n.getRegionId(e.countryCode,e.administrativeArea);return{street:[e.address1,e.address2],postcode:e.postalCode,country_code:e.countryCode,company:e.company||"",email:t,firstname:o,lastname:p.length?p.join(" "):"UNKNOWN",city:e.locality,telephone:a,region:{...e.administrativeArea?{region:e.administrativeArea}:{},...r?{region_id:r}:{}}}}}};$.render=function(e,t,a,n,o,p){return m(),h("div",{id:"ppcp-google-pay",ref:"PPCPGooglePay",class:g(o.googlePayLoaded?"":"text-loading"),"data-cy":"instant-checkout-PPCPGooglePay"},null,2)},$.__file="src/components/ExpressPayments/GooglePay/GooglePay.vue";export{$ as default};

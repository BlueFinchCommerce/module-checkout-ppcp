import{h as e,i as t,r as a,w as o,a as n,m as p,e as r,b as s,d as i,t as c,n as l,g as d,f as _,j as u,k as g,c as y,l as h,o as m}from"../../../runtime-core.esm-bundler-BkTYBQhz.min.js";
/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let C;const f=e=>C=e,w=Symbol();function v(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var P;!function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"}(P||(P={}));const b="undefined"!=typeof window,S="undefined"!=typeof __VUE_PROD_DEVTOOLS__&&__VUE_PROD_DEVTOOLS__&&b,A=()=>{};function I(e,t,a,o=A){e.push(t);const n=()=>{const a=e.indexOf(t);a>-1&&(e.splice(a,1),o())};return!a&&d()&&_(n),n}function k(e,...t){e.slice().forEach((e=>{e(...t)}))}const O=e=>e();function L(e,t){e instanceof Map&&t instanceof Map&&t.forEach(((t,a)=>e.set(a,t))),e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const a in t){if(!t.hasOwnProperty(a))continue;const o=t[a],n=e[a];v(n)&&v(o)&&e.hasOwnProperty(a)&&!s(o)&&!i(o)?e[a]=L(n,o):e[a]=o}return e}const M=Symbol();const{assign:E}=Object;function N(e,t,d={},_,u,g){let y;const h=E({actions:{}},d),m={deep:!0};let C,w,b,N=[],T=[];const D=_.state.value[e];g||D||(_.state.value[e]={});const $=a({});let x;function R(t){let a;C=w=!1,"function"==typeof t?(t(_.state.value[e]),a={type:P.patchFunction,storeId:e,events:b}):(L(_.state.value[e],t),a={type:P.patchObject,payload:t,storeId:e,events:b});const o=x=Symbol();l().then((()=>{x===o&&(C=!0)})),w=!0,k(N,a,_.state.value[e])}const G=g?function(){const{state:e}=d,t=e?e():{};this.$patch((e=>{E(e,t)}))}:A;function j(t,a){return function(){f(_);const o=Array.from(arguments),n=[],p=[];let r;k(T,{args:o,name:t,store:U,after:function(e){n.push(e)},onError:function(e){p.push(e)}});try{r=a.apply(this&&this.$id===e?this:U,o)}catch(e){throw k(p,e),e}return r instanceof Promise?r.then((e=>(k(n,e),e))).catch((e=>(k(p,e),Promise.reject(e)))):(k(n,r),r)}}const F=p({actions:{},getters:{},state:[],hotState:$}),q={_p:_,$id:e,$onAction:I.bind(null,T),$patch:R,$reset:G,$subscribe(t,a={}){const n=I(N,t,a.detached,(()=>p())),p=y.run((()=>o((()=>_.state.value[e]),(o=>{("sync"===a.flush?w:C)&&t({storeId:e,type:P.direct,events:b},o)}),E({},m,a))));return n},$dispose:function(){y.stop(),N=[],T=[],_._s.delete(e)}},U=n(S?E({_hmrPayload:F,_customProperties:p(new Set)},q):q);_._s.set(e,U);const V=(_._a&&_._a.runWithContext||O)((()=>_._e.run((()=>(y=r()).run(t)))));for(const t in V){const a=V[t];if(s(a)&&(!s(H=a)||!H.effect)||i(a))g||(!D||v(B=a)&&B.hasOwnProperty(M)||(s(a)?a.value=D[t]:L(a,D[t])),_.state.value[e][t]=a);else if("function"==typeof a){const e=j(t,a);V[t]=e,h.actions[t]=a}}var B,H;if(E(U,V),E(c(U),V),Object.defineProperty(U,"$state",{get:()=>_.state.value[e],set:e=>{R((t=>{E(t,e)}))}}),S){const e={writable:!0,configurable:!0,enumerable:!1};["_p","_hmrPayload","_getters","_customProperties"].forEach((t=>{Object.defineProperty(U,t,E({value:U[t]},e))}))}return _._p.forEach((e=>{if(S){const t=y.run((()=>e({store:U,app:_._a,pinia:_,options:h})));Object.keys(t||{}).forEach((e=>U._customProperties.add(e))),E(U,t)}else E(U,y.run((()=>e({store:U,app:_._a,pinia:_,options:h}))))})),D&&g&&d.hydrate&&d.hydrate(U.$state,D),C=!0,w=!0,U}var T=function(a,o,n){let r,s;const i="function"==typeof o;function c(a,n){const c=e();(a=a||(c?t(w,null):null))&&f(a),(a=C)._s.has(r)||(i?N(r,o,s,a):function(e,t,a){const{state:o,actions:n,getters:r}=t,s=a.state.value[e];let i;i=N(e,(function(){s||(a.state.value[e]=o?o():{});const t=u(a.state.value[e]);return E(t,n,Object.keys(r||{}).reduce(((t,o)=>(t[o]=p(g((()=>{f(a);const t=a._s.get(e);return r[o].call(t,t)}))),t)),{}))}),t,a,0,!0)}(r,s,a));return a._s.get(r)}return"string"==typeof a?(r=a,s=i?n:o):(s=a,r=a.id),c.$id=r,c}("ppcpStore",{state:()=>({cache:{},environment:"sandbox",isPPCPenabled:!1,sandboxClientId:"",productionClientId:"",buyerCountry:"",errorMessage:null,apple:{merchantName:"",enabled:!1,paymentAction:"",sortOrder:null,title:""},venmo:{vaultActive:!1,enabled:!1,paymentAction:"",sortOrder:null,title:""},apm:{enabled:!1,title:"",sortOrder:null,allowedPayments:[]},google:{buttonColor:"white",enabled:!1,paymentAction:"",sortOrder:null,title:""},paypal:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",requireBillingAddress:!1,sortOrder:null,buttonLabel:"",buttonColor:"gold",buttonShape:"",payLaterActive:!1,payLaterButtonColour:"black",payLaterButtonShape:"",payLaterMessageActive:!1,payLaterMessageLayout:"",payLaterMessageLogoType:"",payLaterMessageLogoPosition:"",payLaterMessageColour:"",payLaterMessageTextSize:"",payLaterMessageTextAlign:""},card:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",threeDSecureStatus:"",sortOrder:null}}),actions:{setData(e){this.$patch(e)},async getInitialConfigValues(){const e=await window.geneCheckout.helpers.loadFromCheckout(["services.graphQlRequest"]);await this.getCachedResponse((async()=>e("{\n        storeConfig {\n          ppcp_environment\n          ppcp_active\n          ppcp_sandbox_client_id\n          ppcp_client_id_production\n          ppcp_buyer_country\n          \n          ppcp_googlepay_active\n          ppcp_googlepay_title\n          ppcp_googlepay_payment_action\n          ppcp_googlepay_button_colour\n          ppcp_googlepay_sort_order\n          \n          ppcp_applepay_active\n          ppcp_applepay_title\n          ppcp_applepay_payment_action\n          ppcp_applepay_merchant_name\n          ppcp_applepay_sort_order\n    \n          ppcp_paypal_active\n          ppcp_paypal_vault_active\n          ppcp_paypal_title\n          ppcp_paypal_payment_action\n          ppcp_paypal_require_billing_address\n          ppcp_paypal_sort_order\n          ppcp_paypal_button_paypal_label\n          ppcp_paypal_button_paypal_color\n          ppcp_paypal_button_paypal_shape\n          ppcp_paypal_paylater_enable_paylater\n          ppcp_paypal_paylater_button_paylater_color\n          ppcp_paypal_paylater_button_paylater_shape\n          ppcp_paypal_paylater_message_enable\n          ppcp_paypal_paylater_message_layout\n          ppcp_paypal_paylater_message_logo_type\n          ppcp_paypal_paylater_message_logo_position\n          ppcp_paypal_paylater_message_text_color\n          ppcp_paypal_paylater_message_text_size\n          ppcp_paypal_paylater_message_text_align\n\n          ppcp_venmo_active\n          ppcp_venmo_title\n          ppcp_venmo_payment_action\n          ppcp_venmo_vault_active\n          ppcp_venmo_sort_order\n          \n          ppcp_apm_active\n          ppcp_apm_title\n          ppcp_apm_allowed_methods\n          ppcp_apm_sort_order\n          \n          ppcp_card_active\n          ppcp_card_vault_active\n          ppcp_card_title\n          ppcp_card_payment_action\n          ppcp_card_three_d_secure\n          ppcp_card_sort_order\n        }\n      }").then(this.handleInitialConfig)),"getInitialConfig")},async handleInitialConfig(e){e?.data?.storeConfig&&this.setData({environment:e.data.storeConfig.ppcp_environment,isPPCPenabled:e.data.storeConfig.ppcp_active,sandboxClientId:e.data.storeConfig.ppcp_sandbox_client_id,productionClientId:e.data.storeConfig.ppcp_client_id_production,buyerCountry:e.data.storeConfig.ppcp_buyer_country,card:{enabled:e.data.storeConfig.ppcp_card_active,vaultActive:e.data.storeConfig.ppcp_card_vault_active,title:e.data.storeConfig.ppcp_card_title,paymentAction:e.data.storeConfig.ppcp_card_payment_action,threeDSecureStatus:e.data.storeConfig.ppcp_card_three_d_secure,sortOrder:e.data.storeConfig.ppcp_card_sort_order},google:{buttonColor:e.data.storeConfig.ppcp_googlepay_button_colour,enabled:e.data.storeConfig.ppcp_googlepay_active,paymentAction:e.data.storeConfig.ppcp_googlepay_payment_action,sortOrder:e.data.storeConfig.ppcp_googlepay_sort_order,title:e.data.storeConfig.ppcp_googlepay_title},apple:{merchantName:e.data.storeConfig.ppcp_applepay_merchant_name,enabled:e.data.storeConfig.ppcp_applepay_active,paymentAction:e.data.storeConfig.ppcp_applepay_payment_action,sortOrder:e.data.storeConfig.ppcp_applepay_sort_order,title:e.data.storeConfig.ppcp_applepay_title},venmo:{vaultActive:e.data.storeConfig.ppcp_venmo_payment_action,enabled:e.data.storeConfig.ppcp_venmo_active,paymentAction:e.data.storeConfig.ppcp_venmo_payment_action,sortOrder:e.data.storeConfig.ppcp_venmo_sort_order,title:e.data.storeConfig.ppcp_venmo_title},apm:{enabled:e.data.storeConfig.ppcp_apm_active,title:e.data.storeConfig.ppcp_apm_title,sortOrder:e.data.storeConfig.ppcp_apm_sort_order,allowedPayments:e.data.storeConfig.ppcp_apm_allowed_methods},paypal:{enabled:e.data.storeConfig.ppcp_paypal_active,vaultActive:e.data.storeConfig.ppcp_paypal_vault_active,title:e.data.storeConfig.ppcp_paypal_title,paymentAction:e.data.storeConfig.ppcp_paypal_payment_action,requireBillingAddress:e.data.storeConfig.ppcp_paypal_require_billing_address,sortOrder:e.data.storeConfig.ppcp_paypal_sort_order,buttonLabel:e.data.storeConfig.ppcp_paypal_button_paypal_label,buttonColor:e.data.storeConfig.ppcp_paypal_button_paypal_color,buttonShape:e.data.storeConfig.ppcp_paypal_button_paypal_shape,payLaterActive:e.data.storeConfig.ppcp_paypal_paylater_enable_paylater,payLaterButtonColour:e.data.storeConfig.ppcp_paypal_paylater_button_paylater_color,payLaterButtonShape:e.data.storeConfig.ppcp_paypal_paylater_button_paylater_shape,payLaterMessageActive:e.data.storeConfig.ppcp_paypal_paylater_message_enable,payLaterMessageLayout:e.data.storeConfig.ppcp_paypal_paylater_message_layout,payLaterMessageLogoType:e.data.storeConfig.ppcp_paypal_paylater_message_logo_type,payLaterMessageLogoPosition:e.data.storeConfig.ppcp_paypal_paylater_message_logo_position,payLaterMessageColour:e.data.storeConfig.ppcp_paypal_paylater_message_text_color,payLaterMessageTextSize:e.data.storeConfig.ppcp_paypal_paylater_message_text_size,payLaterMessageTextAlign:e.data.storeConfig.ppcp_paypal_paylater_message_text_align}})},getCachedResponse(e,t,a={}){if(void 0!==this.$state.cache[t])return this.$state.cache[t];const o=e(a);return this.$patch({cache:{[t]:o}}),o},clearCache(e){e&&this.setData({cache:{[e]:void 0}})}}});var D,$,x=async e=>{const[t,a,o]=await window.geneCheckout.helpers.loadFromCheckout(["stores.usePaymentStore","stores.useCustomerStore","stores.useCartStore"]),n={"X-Requested-With":"XMLHttpRequest"},{maskedId:p,getMaskedId:r}=o;let s;if(a.customer.tokenType===window.geneCheckout.helpers.getTokenTypes.guestUser)s=p||await r();else{s=(await window.geneCheckout.services.getQuote()).id}try{return(await window.geneCheckout.services.authenticatedRequest().post(await(async()=>{const e=(await window.geneCheckout.helpers.loadFromCheckout(["stores.useCustomerStore"])).customer.tokenType===window.geneCheckout.helpers.getTokenTypes.guestUser?"/ppcp/createGuestOrder":"/ppcp/createOrder";return`${window.geneCheckout.helpers.getBaseRestUrl()}${e}`})(),{cartId:s,method:e},{headers:n})).data}catch(e){return t.setPaymentErrorMessage(e.response.data.message),null}},R={name:"PpcpGooglePay",data:()=>({googlePayNoShippingMethods:"",googlePayLoaded:!1,googlepayConfig:null,key:"ppcpGooglePay",method:"ppcp_googlepay",orderID:null}),computed:{...(D=T,$=["google","environment","buyerCountry","productionClientId","sandboxClientId","google"],Array.isArray($)?$.reduce(((e,t)=>(e[t]=function(){return D(this.$pinia)[t]},e)),{}):Object.keys($).reduce(((e,t)=>(e[t]=function(){const e=D(this.$pinia),a=$[t];return"function"==typeof a?a.call(this,e):e[a]},e)),{}))},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart(),await this.getInitialConfigValues(),await this.initGooglePay()},mounted(){const e=document.createElement("script");e.setAttribute("src","https://pay.google.com/gp/p/js/pay.js"),document.head.appendChild(e)},methods:{...function(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]=function(...t){return e(this.$pinia)[a](...t)},t)),{}):Object.keys(t).reduce(((a,o)=>(a[o]=function(...a){return e(this.$pinia)[t[o]](...a)},a)),{})}(T,["getInitialConfigValues"]),async initGooglePay(){try{await this.addSdkScript();const e=await this.deviceSupported(),t=await this.createGooglePayClient(e),a=await this.createGooglePayButton(t);a&&(document.getElementById("ppcp-google-pay").appendChild(a),this.googlePayLoaded=!0)}catch(e){console.warn(e)}},async addSdkScript(){const e=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),t=function(){const e=new Map;return async function(t,a,o="paypal",n="checkout",p=""){if(a){const e=new URLSearchParams(a).toString();t=`${t}?${e}`}const r=((e,t,a="")=>`${e}${t}${a}`)(t,o,p);if(e.has(r))return e.get(r);const s=new Promise(((a,s)=>{const i=document.createElement("script");i.src=t,i.dataset.namespace=`paypal_${o}`,i.dataset.partnerAttributionId="GENE_PPCP",i.dataset.pageType=n,p&&(i.dataset.userIdToken=p),i.onload=()=>{const e=new CustomEvent("ppcpScriptLoaded",{detail:o});document.dispatchEvent(e),a()},i.onerror=()=>{e.delete(r),s(new Error(`Failed to load script: ${t}`))},document.head.appendChild(i)}));return e.set(r,s),s}}(),a={intent:this.google.paymentAction,currency:e.currencyCode,components:"googlepay"};return"sandbox"===this.environment?(a["buyer-country"]=this.buyerCountry,a["client-id"]=this.sandboxClientId):a["client-id"]=this.productionClientId,t("https://www.paypal.com/sdk/js",a,"ppcp_googlepay")},deviceSupported(){return new Promise(((e,t)=>{if("https:"!==window.location.protocol)return console.warn("Google Pay requires your checkout be served over HTTPS"),void t(new Error("Insecure protocol: HTTPS is required for Google Pay"));this.googlepay=window.paypal_ppcp_googlepay.Googlepay(),this.googlepay.config().then((async a=>{a.isEligible?(a.allowedPaymentMethods.forEach((e=>{e.parameters.billingAddressParameters.phoneNumberRequired=!0})),e(a)):t(new Error("Device not eligible for Google Pay"))})).catch((e=>{t(e)}))}))},createGooglePayClient(e){const t={onPaymentAuthorized:this.onPaymentAuthorized};return this.onPaymentDataChanged&&(t.onPaymentDataChanged=t=>this.onPaymentDataChanged(t,e)),this.googlePayClient=new window.google.payments.api.PaymentsClient({environment:this.getEnvironment(),paymentDataCallbacks:t}),this.googlePayClient.isReadyToPay({apiVersion:e.apiVersion,apiVersionMinor:e.apiVersionMinor,allowedPaymentMethods:e.allowedPaymentMethods}).then((t=>t.result?e:null))},createGooglePayButton(e){return this.googlePayClient.createButton({allowedPaymentMethods:e.allowedPaymentMethods,buttonColor:this.google.buttonColor.toLowerCase(),buttonSizeMode:"fill",onClick:()=>this.onClick(e)})},async onClick(e){const[t,a,o,n,p,r]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useShippingMethodsStore","stores.usePaymentStore"]);r.setErrorMessage("");if(!t.validateAgreements())return!1;p.setNotClickAndCollect();const s={...e},i=["PAYMENT_AUTHORIZATION"],c=this.onPaymentDataChanged&&!a.cart.is_virtual;return c&&i.push("SHIPPING_ADDRESS","SHIPPING_OPTION"),s.allowedPaymentMethods=e.allowedPaymentMethods,s.transactionInfo={countryCode:e.countryCode,currencyCode:o.currencyCode,totalPriceStatus:"FINAL",totalPrice:(a.cartGrandTotal/100).toString()},s.merchantInfo=e.merchantInfo,s.shippingAddressRequired=c,s.shippingAddressParameters={phoneNumberRequired:c},s.emailRequired=!0,s.shippingOptionRequired=c,s.callbackIntents=i,delete s.countryCode,delete s.isEligible,n.setLoadingState(!0),this.googlePayClient.loadPaymentData(s).catch((e=>{console.warn(e)}))},async onPaymentDataChanged(e,t){const[a,o,n,p]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useShippingMethodsStore"]);return new Promise((r=>{const s={city:e.shippingAddress.locality,company:"",country_code:e.shippingAddress.countryCode,postcode:e.shippingAddress.postalCode,region:e.shippingAddress.administrativeArea,region_id:o.getRegionId(e.shippingAddress.countryCode,e.shippingAddress.administrativeArea),street:["0"],telephone:"000000000",firstname:"UNKNOWN",lastname:"UNKNOWN"};window.geneCheckout.services.getShippingMethods(s,this.method,!0).then((async o=>{const s=o.shipping_addresses[0].available_shipping_methods,i={},c=s.map((e=>{const t=e.carrier_title?`${window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value)}\n                   ${e.carrier_title}`:window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value);return{id:e.method_code,label:e.method_title,description:t}})).filter((e=>"nominated_delivery"!==e.id));if(!c.length)return void r({error:{reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:this.$t("errorMessages.googlePayNoShippingMethods"),intent:"SHIPPING_ADDRESS"}});const l="shipping_option_unselected"===e.shippingOptionData.id?s[0]:s.find((({method_code:t})=>t===e.shippingOptionData.id))||s[0];await p.submitShippingInfo(l.carrier_code,l.method_code),n.setLoadingState(!0),i.newShippingOptionParameters={defaultSelectedOptionId:l.method_code,shippingOptions:c},i.newTransactionInfo={displayItems:[{label:"Shipping",type:"LINE_ITEM",price:l.amount.value.toString(),status:"FINAL"}],currencyCode:a.cart.prices.grand_total.currency,totalPriceStatus:"FINAL",totalPrice:a.cart.prices.grand_total.value.toString(),totalPriceLabel:"Total",countryCode:t.countryCode},r(i)}))}))},async onPaymentAuthorized(e){const t=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]);return new Promise((async a=>{if(!t.cart.is_virtual&&!t.cart.shipping_addresses[0].selected_shipping_method)return void a({error:{reason:"SHIPPING_OPTION_INVALID",message:"No shipping method selected",intent:"SHIPPING_OPTION"}});const o=await this.mapAddress(e.paymentMethodData.info.billingAddress,e.email,e.paymentMethodData.info.billingAddress.phoneNumber);let n=null;t.cart.is_virtual||(n=await this.mapAddress(e.shippingAddress,e.email,e.shippingAddress.phoneNumber));try{await window.geneCheckout.services.setAddressesOnCart(n,o,e.email);const t=await x(this.method);[this.orderID]=JSON.parse(t);const p={orderId:this.orderID,paymentMethodData:e.paymentMethodData},r=await this.googlepay.confirmOrder(p);await this.onApprove(r,e),a({transactionState:"SUCCESS"})}catch(e){a({error:{reason:"PAYMENT_DATA_INVALID",message:e.message,intent:"PAYMENT_AUTHORIZATION"}})}}))},async onApprove(e,t){const[a,o,n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useLoadingStore","stores.useCustomerStore","stores.usePaymentStore"]);if(e.liabilityShift&&"POSSIBLE"!==e.liabilityShift)throw new Error("Cannot validate payment");return this.makePayment(t).then((()=>window.geneCheckout.services.refreshCustomerData(["cart"]))).then((()=>{window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()})).catch((e=>{a.setLoadingState(!1);try{window.geneCheckout.helpers.handleServiceError(e)}catch(e){o.createNewAddress("shipping"),n.setErrorMessage(e)}}))},async makePayment(e){const t={email:e.email,paymentMethod:{method:this.method,additional_data:{"express-payment":!0,"paypal-order-id":this.orderID},extension_attributes:window.geneCheckout.helpers.getPaymentExtensionAttributes()}};return window.geneCheckout.services.createPaymentRest(t)},getEnvironment(){return"sandbox"===this.environment?"TEST":"PRODUCTION"},async mapAddress(e,t,a){const o=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),[n,...p]=e.name.split(" "),r=o.getRegionId(e.countryCode,e.administrativeArea);return{street:[e.address1,e.address2],postcode:e.postalCode,country_code:e.countryCode,company:e.company||"",email:t,firstname:n,lastname:p.length?p.join(" "):"UNKNOWN",city:e.locality,telephone:a,region:{...e.administrativeArea?{region:e.administrativeArea}:{},...r?{region_id:r}:{}}}}}};R.render=function(e,t,a,o,n,p){return m(),y("div",{id:"ppcp-google-pay",class:h(n.googlePayLoaded?"":"text-loading"),"data-cy":"instant-checkout-PPCPGooglePay"},null,2)},R.__file="src/components/ExpressPayments/GooglePay/GooglePay.vue";export{R as default};

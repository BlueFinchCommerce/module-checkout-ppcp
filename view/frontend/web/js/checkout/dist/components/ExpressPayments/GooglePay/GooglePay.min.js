import{h as e,i as t,r as a,w as n,a as p,m as o,e as r,b as s,d as i,t as c,n as l,g as _,f as d,j as u,k as y,c as h,l as g,o as m}from"../../../runtime-core.esm-bundler-BkTYBQhz.min.js";
/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let v;const f=e=>v=e,b=Symbol();function C(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var P;!function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"}(P||(P={}));const S="undefined"!=typeof window,A="undefined"!=typeof __VUE_PROD_DEVTOOLS__&&__VUE_PROD_DEVTOOLS__&&S,I=()=>{};function w(e,t,a,n=I){e.push(t);const p=()=>{const a=e.indexOf(t);a>-1&&(e.splice(a,1),n())};return!a&&_()&&d(p),p}function O(e,...t){e.slice().forEach((e=>{e(...t)}))}const L=e=>e();function M(e,t){e instanceof Map&&t instanceof Map&&t.forEach(((t,a)=>e.set(a,t))),e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const a in t){if(!t.hasOwnProperty(a))continue;const n=t[a],p=e[a];C(p)&&C(n)&&e.hasOwnProperty(a)&&!s(n)&&!i(n)?e[a]=M(p,n):e[a]=n}return e}const N=Symbol();const{assign:k}=Object;function D(e,t,_={},d,u,y){let h;const g=k({actions:{}},_),m={deep:!0};let v,b,S,D=[],E=[];const x=d.state.value[e];y||x||(d.state.value[e]={});const $=a({});let T;function j(t){let a;v=b=!1,"function"==typeof t?(t(d.state.value[e]),a={type:P.patchFunction,storeId:e,events:S}):(M(d.state.value[e],t),a={type:P.patchObject,payload:t,storeId:e,events:S});const n=T=Symbol();l().then((()=>{T===n&&(v=!0)})),b=!0,O(D,a,d.state.value[e])}const R=y?function(){const{state:e}=_,t=e?e():{};this.$patch((e=>{k(e,t)}))}:I;function G(t,a){return function(){f(d);const n=Array.from(arguments),p=[],o=[];let r;O(E,{args:n,name:t,store:U,after:function(e){p.push(e)},onError:function(e){o.push(e)}});try{r=a.apply(this&&this.$id===e?this:U,n)}catch(e){throw O(o,e),e}return r instanceof Promise?r.then((e=>(O(p,e),e))).catch((e=>(O(o,e),Promise.reject(e)))):(O(p,r),r)}}const V=o({actions:{},getters:{},state:[],hotState:$}),F={_p:d,$id:e,$onAction:w.bind(null,E),$patch:j,$reset:R,$subscribe(t,a={}){const p=w(D,t,a.detached,(()=>o())),o=h.run((()=>n((()=>d.state.value[e]),(n=>{("sync"===a.flush?b:v)&&t({storeId:e,type:P.direct,events:S},n)}),k({},m,a))));return p},$dispose:function(){h.stop(),D=[],E=[],d._s.delete(e)}},U=p(A?k({_hmrPayload:V,_customProperties:o(new Set)},F):F);d._s.set(e,U);const q=(d._a&&d._a.runWithContext||L)((()=>d._e.run((()=>(h=r()).run(t)))));for(const t in q){const a=q[t];if(s(a)&&(!s(B=a)||!B.effect)||i(a))y||(!x||C(H=a)&&H.hasOwnProperty(N)||(s(a)?a.value=x[t]:M(a,x[t])),d.state.value[e][t]=a);else if("function"==typeof a){const e=G(t,a);q[t]=e,g.actions[t]=a}}var H,B;if(k(U,q),k(c(U),q),Object.defineProperty(U,"$state",{get:()=>d.state.value[e],set:e=>{j((t=>{k(t,e)}))}}),A){const e={writable:!0,configurable:!0,enumerable:!1};["_p","_hmrPayload","_getters","_customProperties"].forEach((t=>{Object.defineProperty(U,t,k({value:U[t]},e))}))}return d._p.forEach((e=>{if(A){const t=h.run((()=>e({store:U,app:d._a,pinia:d,options:g})));Object.keys(t||{}).forEach((e=>U._customProperties.add(e))),k(U,t)}else k(U,h.run((()=>e({store:U,app:d._a,pinia:d,options:g}))))})),x&&y&&_.hydrate&&_.hydrate(U.$state,x),v=!0,b=!0,U}var E=function(a,n,p){let r,s;const i="function"==typeof n;function c(a,p){const c=e();(a=a||(c?t(b,null):null))&&f(a),(a=v)._s.has(r)||(i?D(r,n,s,a):function(e,t,a){const{state:n,actions:p,getters:r}=t,s=a.state.value[e];let i;i=D(e,(function(){s||(a.state.value[e]=n?n():{});const t=u(a.state.value[e]);return k(t,p,Object.keys(r||{}).reduce(((t,n)=>(t[n]=o(y((()=>{f(a);const t=a._s.get(e);return r[n].call(t,t)}))),t)),{}))}),t,a,0,!0)}(r,s,a));return a._s.get(r)}return"string"==typeof a?(r=a,s=i?p:n):(s=a,r=a.id),c.$id=r,c}("ppcpStore",{state:()=>({cache:{},environment:"sandbox",isPPCPenabled:!1,sandboxClientId:"",productionClientId:"",buyerCountry:"",errorMessage:null,apple:{merchantName:"",enabled:!1,paymentAction:"",sortOrder:null,title:""},venmo:{vaultActive:!1,enabled:!1,paymentAction:"",sortOrder:null,title:""},apm:{enabled:!1,title:"",sortOrder:null,allowedPayments:[]},google:{buttonColor:"white",enabled:!1,paymentAction:"",sortOrder:null,title:""},paypal:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",requireBillingAddress:!1,sortOrder:null,buttonLabel:"",buttonColor:"gold",buttonShape:"",payLaterActive:!1,payLaterButtonColour:"black",payLaterButtonShape:"",payLaterMessageActive:!1,payLaterMessageLayout:"",payLaterMessageLogoType:"",payLaterMessageLogoPosition:"",payLaterMessageColour:"",payLaterMessageTextSize:"",payLaterMessageTextAlign:""},card:{enabled:!1,vaultActive:!1,title:"",paymentAction:"",threeDSecureStatus:"",sortOrder:null}}),getters:{selectedVaultMethod:e=>[]},actions:{setData(e){this.$patch(e)},async getInitialConfigValues(){const e=await window.geneCheckout.helpers.loadFromCheckout(["services.graphQlRequest"]);await this.getCachedResponse((async()=>e("{\n        storeConfig {\n          ppcp_environment\n          ppcp_active\n          ppcp_sandbox_client_id\n          ppcp_client_id_production\n          ppcp_buyer_country\n          \n          ppcp_googlepay_active\n          ppcp_googlepay_title\n          ppcp_googlepay_payment_action\n          ppcp_googlepay_button_colour\n          ppcp_googlepay_sort_order\n          \n          ppcp_applepay_active\n          ppcp_applepay_title\n          ppcp_applepay_payment_action\n          ppcp_applepay_merchant_name\n          ppcp_applepay_sort_order\n    \n          ppcp_paypal_active\n          ppcp_paypal_vault_active\n          ppcp_paypal_title\n          ppcp_paypal_payment_action\n          ppcp_paypal_require_billing_address\n          ppcp_paypal_sort_order\n          ppcp_paypal_button_paypal_label\n          ppcp_paypal_button_paypal_color\n          ppcp_paypal_button_paypal_shape\n          ppcp_paypal_paylater_enable_paylater\n          ppcp_paypal_paylater_button_paylater_color\n          ppcp_paypal_paylater_button_paylater_shape\n          ppcp_paypal_paylater_message_enable\n          ppcp_paypal_paylater_message_layout\n          ppcp_paypal_paylater_message_logo_type\n          ppcp_paypal_paylater_message_logo_position\n          ppcp_paypal_paylater_message_text_color\n          ppcp_paypal_paylater_message_text_size\n          ppcp_paypal_paylater_message_text_align\n\n          ppcp_venmo_active\n          ppcp_venmo_title\n          ppcp_venmo_payment_action\n          ppcp_venmo_vault_active\n          ppcp_venmo_sort_order\n          \n          ppcp_apm_active\n          ppcp_apm_title\n          ppcp_apm_allowed_methods\n          ppcp_apm_sort_order\n          \n          ppcp_card_active\n          ppcp_card_vault_active\n          ppcp_card_title\n          ppcp_card_payment_action\n          ppcp_card_three_d_secure\n          ppcp_card_sort_order\n        }\n      }").then(this.handleInitialConfig)),"getInitialConfig")},async handleInitialConfig(e){if(e?.data?.storeConfig){const t=e.data.storeConfig;this.setData({environment:t.ppcp_environment,isPPCPenabled:t.ppcp_active,sandboxClientId:t.ppcp_sandbox_client_id,productionClientId:t.ppcp_client_id_production,buyerCountry:t.ppcp_buyer_country,card:{enabled:t.ppcp_card_active,vaultActive:t.ppcp_card_vault_active,title:t.ppcp_card_title,paymentAction:t.ppcp_card_payment_action,threeDSecureStatus:t.ppcp_card_three_d_secure,sortOrder:t.ppcp_card_sort_order},google:{buttonColor:t.ppcp_googlepay_button_colour,enabled:t.ppcp_googlepay_active,paymentAction:t.ppcp_googlepay_payment_action,sortOrder:t.ppcp_googlepay_sort_order,title:t.ppcp_googlepay_title},apple:{merchantName:t.ppcp_applepay_merchant_name,enabled:t.ppcp_applepay_active,paymentAction:t.ppcp_applepay_payment_action,sortOrder:t.ppcp_applepay_sort_order,title:t.ppcp_applepay_title},venmo:{vaultActive:t.ppcp_venmo_payment_action,enabled:t.ppcp_venmo_active,paymentAction:t.ppcp_venmo_payment_action,sortOrder:t.ppcp_venmo_sort_order,title:t.ppcp_venmo_title},apm:{enabled:t.ppcp_apm_active,title:t.ppcp_apm_title,sortOrder:t.ppcp_apm_sort_order,allowedPayments:t.ppcp_apm_allowed_methods},paypal:{enabled:t.ppcp_paypal_active,vaultActive:t.ppcp_paypal_vault_active,title:t.ppcp_paypal_title,paymentAction:t.ppcp_paypal_payment_action,requireBillingAddress:t.ppcp_paypal_require_billing_address,sortOrder:t.ppcp_paypal_sort_order,buttonLabel:t.ppcp_paypal_button_paypal_label,buttonColor:t.ppcp_paypal_button_paypal_color,buttonShape:t.ppcp_paypal_button_paypal_shape,payLaterActive:t.ppcp_paypal_paylater_enable_paylater,payLaterButtonColour:t.ppcp_paypal_paylater_button_paylater_color,payLaterButtonShape:t.ppcp_paypal_paylater_button_paylater_shape,payLaterMessageActive:t.ppcp_paypal_paylater_message_enable,payLaterMessageLayout:t.ppcp_paypal_paylater_message_layout,payLaterMessageLogoType:t.ppcp_paypal_paylater_message_logo_type,payLaterMessageLogoPosition:t.ppcp_paypal_paylater_message_logo_position,payLaterMessageColour:t.ppcp_paypal_paylater_message_text_color,payLaterMessageTextSize:t.ppcp_paypal_paylater_message_text_size,payLaterMessageTextAlign:t.ppcp_paypal_paylater_message_text_align}})}},async createClientToken(){},setClientInstance(e){this.setData({clientInstance:e})},setThreeDSInstance(e){this.setData({threeDSecureInstance:e})},setErrorMessage(e){this.setData({errorMessage:e})},clearErrorMessage(){this.setData({errorMessage:null})},escapeNonAsciiCharacters:e=>e.split("").map((e=>/[^\x00-\x7F]$/.test(e)?e:e.split("").map((e=>`\\u00${e.charCodeAt().toString(16)}`)).join(""))).join(""),async getVaultedMethods(){},selectVaultedMethod(e){this.unselectVaultedMethods(),this.setData({vaultedMethods:{[e.publicHash]:{selected:!0}}})},mapCartTypes(e){switch(e){case"AE":return"american-express";case"DI":return"discover";case"DN":return"diners-club";case"JCB":return"jcb";case"MC":return"master-card";case"MI":return"maestro";case"UPD":return"unionpay";case"VI":return"visa";default:return""}},unselectVaultedMethods(){Object.keys(this.vaultedMethods).forEach((e=>{this.setData({vaultedMethods:{[e]:{selected:!1}}})}))},getCachedResponse(e,t,a={}){if(void 0!==this.$state.cache[t])return this.$state.cache[t];const n=e(a);return this.$patch({cache:{[t]:n}}),n},clearCache(e){e&&this.setData({cache:{[e]:void 0}})}}});var x,$,T={name:"PpcpGooglePay",data:()=>({googlePayNoShippingMethods:"",instance:null,googleClient:null,googlePaymentInstance:null,googlePayLoaded:!1,key:"ppcpGooglePay",method:"ppcp_googlepay"}),computed:{...(x=E,$=["google","environment","buyerCountry","productionClientId","sandboxClientId"],Array.isArray($)?$.reduce(((e,t)=>(e[t]=function(){return x(this.$pinia)[t]},e)),{}):Object.keys($).reduce(((e,t)=>(e[t]=function(){const e=x(this.$pinia),a=$[t];return"function"==typeof a?a.call(this,e):e[a]},e)),{}))},async created(){const[e,t,a]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.usePaymentStore","stores.useConfigStore"]);t.addExpressMethod(this.key),await a.getInitialConfig(),await e.getCart(),await this.getInitialConfigValues(),this.addSdkScript()},methods:{...function(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]=function(...t){return e(this.$pinia)[a](...t)},t)),{}):Object.keys(t).reduce(((a,n)=>(a[n]=function(...a){return e(this.$pinia)[t[n]](...a)},a)),{})}(E,["getInitialConfigValues"]),addSdkScript(){const e=function(){const e=new Map;return async function(t,a,n="paypal",p="checkout",o=""){if(a){const e=new URLSearchParams(a).toString();t=`${t}?${e}`}const r=((e,t,a="")=>`${e}${t}${a}`)(t,n,o);if(e.has(r))return e.get(r);const s=new Promise(((a,s)=>{const i=document.createElement("script");i.src=t,i.dataset.namespace=`paypal_${n}`,i.dataset.partnerAttributionId="GENE_PPCP",i.dataset.pageType=p,o&&(i.dataset.userIdToken=o),i.onload=()=>{const e=new CustomEvent("ppcpScriptLoaded",{detail:n});document.dispatchEvent(e),a()},i.onerror=a=>{e.delete(r),s(new Error(`Failed to load script: ${t}`))},document.head.appendChild(i)}));return e.set(r,s),s}}(),t={intent:this.google.paymentAction,components:"googlepay"};"sandbox"===this.environment?(t["buyer-country"]=this.buyerCountry,t["client-id"]=this.sandboxClientId):t["client-id"]=this.productionClientId,e("https://www.paypal.com/sdk/js",t).then((()=>{console.log("loadded")})).catch((e=>{console.error("Failed to load GooglePay script:",e)}))},async onClick(e){const[t,a,n,p,o,r,s]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useAgreementStore","stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useCustomerStore","stores.useShippingMethodsStore","stores.usePaymentStore"]);s.setErrorMessage("");if(!t.validateAgreements())return!1;r.setNotClickAndCollect();const i=["PAYMENT_AUTHORIZATION"];a.cart.is_virtual||i.push("SHIPPING_ADDRESS","SHIPPING_OPTION");const c={transactionInfo:{countryCode:n.countryCode,currencyCode:n.currencyCode,totalPriceStatus:"FINAL",totalPrice:(a.cartGrandTotal/100).toString()},emailRequired:!0,shippingAddressRequired:!a.cart.is_virtual,shippingAddressParameters:{phoneNumberRequired:!a.cart.is_virtual},shippingOptionRequired:!a.cart.is_virtual,callbackIntents:i};"sandbox"!==this.environment&&(c.merchantInfo={merchantId:this.google.merchantId});const l=this.googlePaymentInstance.createPaymentDataRequest(c),_=l.allowedPaymentMethods[0];return _.parameters.billingAddressRequired=!0,_.parameters.billingAddressParameters={format:"FULL",phoneNumberRequired:!0},window.geneCheckout.helpers.expressPaymentOnClickDataLayer(e),p.setLoadingState(!0),this.googleClient.loadPaymentData(l).then(this.makePayment).then((()=>window.geneCheckout.services.refreshCustomerData(["cart"]))).then((()=>{window.location.href=window.geneCheckout.helpers.getSuccessPageUrl()})).catch((e=>{p.setLoadingState(!1);try{window.geneCheckout.helpers.handleServiceError(e)}catch(e){o.createNewAddress("shipping"),s.setErrorMessage(e)}}))},getGooglePayMethod:e=>e.paymentMethods.find((({type:e})=>"paywithgoogle"===e||"googlepay")),async onPaymentDataChanged(e){const[t,a,n,p]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore","stores.useConfigStore","stores.useLoadingStore","stores.useShippingMethodsStore"]);return new Promise((o=>{const r={city:e.shippingAddress.locality,company:"",country_code:e.shippingAddress.countryCode,postcode:e.shippingAddress.postalCode,region:e.shippingAddress.administrativeArea,region_id:a.getRegionId(e.shippingAddress.countryCode,e.shippingAddress.administrativeArea),street:["0"],telephone:"000000000",firstname:"UNKNOWN",lastname:"UNKNOWN"};window.geneCheckout.services.getShippingMethods(r,this.method,!0).then((async r=>{const s=r.shipping_addresses[0].available_shipping_methods,i=s.map((e=>{const t=e.carrier_title?`${window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value)} ${e.carrier_title}`:window.geneCheckout.helpers.formatPrice(e.price_incl_tax.value);return{id:e.method_code,label:e.method_title,description:t}})).filter((e=>"nominated_delivery"!==e.id));if(!i.length)return void o({error:{reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:this.$t("errorMessages.googlePayNoShippingMethods"),intent:"SHIPPING_ADDRESS"}});const c="shipping_option_unselected"===e.shippingOptionData.id?s[0]:s.find((({method_code:t})=>t===e.shippingOptionData.id))||s[0];await p.submitShippingInfo(c.carrier_code,c.method_code),n.setLoadingState(!0);const l={newShippingOptionParameters:{defaultSelectedOptionId:c.method_code,shippingOptions:i},newTransactionInfo:{displayItems:[{label:"Shipping",type:"LINE_ITEM",price:t.cart.shipping_addresses[0].selected_shipping_method.amount.value.toString(),status:"FINAL"}],currencyCode:t.cart.prices.grand_total.currency,totalPriceStatus:"FINAL",totalPrice:t.cart.prices.grand_total.value.toString(),totalPriceLabel:"Total",countryCode:a.countryCode}};o(l)}))}))},async onPaymentAuthorized(e){const[t]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useCartStore"]);return new Promise((a=>{if(!t.cart.is_virtual&&!t.cart.shipping_addresses[0].selected_shipping_method)return void a({error:{reason:"SHIPPING_OPTION_INVALID",message:"No shipping method selected",intent:"SHIPPING_OPTION"}});const{androidPayCards:n}=JSON.parse(e.paymentMethodData.tokenizationData.token);if(!n?.[0]?.nonce||!n?.[0]?.details?.bin)return void a({error:{reason:"SHIPPING_OPTION_INVALID",message:"Unable to validate payment. Please try again with another payment method.",intent:"SHIPPING_OPTION"}});const{email:p}=e,{billingAddress:o}=e.paymentMethodData.info,{phoneNumber:r}=o,s=this.mapAddress(o,p,r);let i=null;if(!t.cart.is_virtual){const{shippingAddress:t}=e,{phoneNumber:a}=t;i=this.mapAddress(t,p,a)}try{window.geneCheckout.services.setAddressesOnCart(i,s,p).then((()=>{a({transactionState:"SUCCESS"})}))}catch(e){a({error:{reason:"PAYMENT_DATA_INVALID",message:e.message,intent:"PAYMENT_AUTHORIZATION"}})}}))},makePayment(e){const t={email:e.email,paymentMethod:{method:this.method,additional_data:{payment_method_nonce:e.nonce},extension_attributes:window.geneCheckout.helpers.getPaymentExtensionAttributes()}};return window.geneCheckout.services.createPayment(t)},async mapAddress(e,t,a){const[n]=await window.geneCheckout.helpers.loadFromCheckout(["stores.useConfigStore"]),[p,...o]=e.name.split(" "),r=n.getRegionId(e.countryCode,e.administrativeArea);return{street:[e.address1,e.address2],postcode:e.postalCode,country_code:e.countryCode,company:e.company||"",email:t,firstname:p,lastname:o.length?o.join(" "):"UNKNOWN",city:e.locality,telephone:a,region:{...e.administrativeArea?{region:e.administrativeArea}:{},...r?{region_id:r}:{}}}}}};T.render=function(e,t,a,n,p,o){return m(),h("div",{id:"ppcp-google-pay",class:g(p.googlePayLoaded?"":"text-loading"),"data-cy":"instant-checkout-PPCPGooglePay"},null,2)},T.__file="src/components/ExpressPayments/GooglePay/GooglePay.vue";export{T as default};
